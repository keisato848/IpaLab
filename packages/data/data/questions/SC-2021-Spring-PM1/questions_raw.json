{
  "qNo": 1,
  "theme": "認証システムの開発 (OAuthによるID連携)",
  "description": "S社は従業員10名のベンチャー企業で、ファイル共有サービス（Sサービス）を提供している。S社は、利用者ID/パスワード認証を使用していたが、多要素認証対応が課題となっていた。CTOのF氏は、多要素認証機能を持つT社のTサービス（認証認可提供SNS）とSサービスをID連携する改修を提案した。今回の改修ではOAuthのAuthorization Code Grantを採用し、新規会員登録者のみを対象とする。既存会員の認証のため、従来のS認証モジュールも継続稼働させる。\n\nF氏は、X氏に対し、①S認証モジュールの代わりにTサービスとのID連携を利用する利点と欠点を説明し、改修が承認された。\n\n### 図1 OAuthを用いた認可における三つの主体の説明\n| 主体 | 説明 |\n| :--- | :--- |\n| 利用者 | T サービスのアカウントをもち、S会員の登録を希望する者(以下, S会員登録希望者という)及び登録されたS会員である。 |\n| Sサービス | Tサービスでのアカウント名を要求する。 |\n| Tサービス | 認証認可提供SNSである。図3に示す権限を提供する。 |\n\n### 図2 OAuthを用いた認可のシーケンス\n```mermaid\nsequenceDiagram\n    actor U as 利用者\n    participant S as Sサービス\n    participant T as Tサービス\n    U->>S: (あ) 利用開始\n    S->>T: (い) 認可の要求\n    T-->>U: リダイレクト (う) 認可の要求\n    U->>T: (え) 認証,権限付与の確認\n    T-->>U: リダイレクト (お) 認可コード\n    U->>S: (か) 認可コード\n    S->>T: (き) アクセストークンの要求\n    T->>S: (く) アクセストークン\n    S->>T: (け) アカウント名の要求\n    T->>S: (こ) アカウント名\n    Note over S, T: Sサービスは初回利用時、Tサービスから取得したアカウント名 (T-ID)をSサービス内に登録する。2回目以降はT-IDを確認する。\n```\n\n### 図3 Tサービスが提供する権限\n| 記号 | 権限 |\n| :--- | :--- |\n| (ア) | 他の利用者の投稿に対し“いいね”を送信する権限 |\n| (イ) | 他の利用者へのメッセージを送信する権限 |\n| (ウ) | 利用者の代わりに投稿する権限 |\n| (エ) | 利用者のアカウント名、電子メールアドレスなど登録情報を取得する権限 |\n\n図2のシーケンスにおいて, [ a ] は, [ b ] が提供するリソースにアクセスできる。それは [ c ] が,図3に示す権限を [ α ] に与えるからである。 [ c ] は [ a ] に与える権限を図2中の [ α ] の通信の際に確認する。図3のうち、どの権限を要求するかは、[ a ] の実装者が決定する。\n\n### 〔一つ目の問題〕\nセキュリティ専門家Y氏のレビューで、一つ目の問題として、以下の攻撃シナリオが指摘された。\n\nS サービスにログインしていない利用者が攻撃者の用意した罠サイトにアクセスすると、図4中に示すシーケンスXが走り、後に、②利用者が攻撃を受けているとは知らずにSサービスにファイルをアップロードすると、そのファイルを攻撃者にダウンロードされてしまうおそれがある。\n\n### 図4 攻撃のシーケンス\n```mermaid\nsequenceDiagram\n    actor U as 利用者\n    participant Attacker as 攻撃者\n    participant S as Sサービス\n    participant T as Tサービス\n    \n    Note over U, T: シーケンスX\n    U->>Attacker: 罠サイトへのアクセス\n    Attacker->>S: 利用開始\n    S->>T: 認可の要求\n    T-->>U: リダイレクト 認可の要求\n    U->>T: 認証,権限付与の確認\n    T-->>Attacker: リダイレクト 認可コード\n    U->>Attacker: d\n    Attacker->>S: 認可コード d\n    S->>T: アクセストークン要求\n    T->>S: e アクセストークン\n    \n    U->>S: ファイルのアップロード\n    Note over Attacker, T: (攻撃者がeを利用してファイルダウンロードの権限を持つ)\n```\n\nこの対策として、RFC6749は`state`パラメータを利用することを推奨している。Sサービスは state パラメタを [ β ] を送信する際に付与する。Sサービスは [ γ ] を受信する際に、そのセッションが、state パラメタを付与した際の [ β ] のセッションと同一であるか否かを確認する。\n\n### 〔二つ目と三つ目の問題〕\n二つ目の問題は、③S サービスがTサービスに要求する権限が必要最小限のものになっていないこと。三つ目の問題は、Tサービスに深刻な脆弱性が報告された場合の対応方法（ID連携の一時停止と、④一部のS会員への代替策検討）を決めていなかったことである。\n\n### 〔利用者認証の実現について〕\n⑤S サービスは、Tサービスと連携して、登録されたS会員をどのように利用者認証しているかを解説した。",
  "questions": [
    {
      "subQNo": "設問1",
      "text": "〔Sサービスの改修〕について、(1)~(4)に答えよ。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "本文中の下線①について, S社の課題に即した利点を 30 字以内で具体的に述べよ。",
          "explanation": "### 解説\nS社の課題は、脆弱性診断で多要素認証が推奨されたものの、自社での対処が課題であった点です。Tサービスは多要素認証の機能を持っています。ID連携により、Sサービス自身が多要素認証を実装する手間なく、Tサービスが提供する高度な認証機能を利用できるようになります。\n\n**解答:** Tサービスの多要素認証などの機能を利用できること。",
          "point": 10
        },
        {
          "label": "(2)",
          "text": "本文中の下線①について、可用性の観点での欠点を30字以内で述べよ。",
          "explanation": "### 解説\nID連携は外部サービスであるTサービスに依存します。可用性の観点では、Tサービス側でシステム障害やサービス停止が発生した場合、Sサービスの認証機能が利用できなくなります。\n\n**解答:** Tサービスが停止した場合、Sサービスにログインできなくなること。",
          "point": 10
        },
        {
          "label": "(3)",
          "text": "本文中の [ a ], [ c ] に入れる適切な字句を解答群の中から選び、記号で答えよ。\n解答群: ア Sサービス, イ Tサービス, ウ 利用者",
          "explanation": "### 解説\nOAuthの定義に基づき、リソースにアクセスできる主体 [ a ] はクライアントであるSサービス（ア）です。リソースにアクセスする権限をSサービスに与える主体 [ c ] はリソースオーナーである利用者（ウ）です。\n\n**解答:** a: ア, c: ウ",
          "point": 10
        },
        {
          "label": "(4)",
          "text": "本文中の [ α ] に入れる適切な字句を、図2中の(あ)~(こ)から選び、記号で答えよ。",
          "explanation": "### 解説\n「利用者はSサービスに与える権限を、図2中の [ α ] の通信の際に確認する」とあります。これは利用者がTサービス上で認証を済ませた後、Sサービスが要求しているスコープ（権限）に対して同意を与えるステップです。図2では「(え) 認証,権限付与の確認」がこれに該当します。\n\n**解答:** (え)",
          "point": 10
        }
      ],
      "subCategory": "その他"
    },
    {
      "subQNo": "設問2",
      "text": "〔一つ目の問題〕について、(1)~(3)に答えよ。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "図4中の [ d ], [ e ] に入れる適切な字句を解答群の中から選び、記号で答えよ。\n解答群: ア アクセストークンの要求, イ アクセストークン, ウ 認可コード, エ 認可の要求, オ 認証,権限付与の確認",
          "explanation": "### 解説\n図4はAuthorization Code GrantにおけるCSRF攻撃（認可コードの横取り）を示しています。\n\n1.  **[ d ]**: 認可サーバー（Tサービス）からリダイレクトで返され、攻撃者に渡ってしまう短い有効期限のトークンです。これは**認可コード**です (図2の(お), (か)に対応)。→ ウ\n2.  **[ e ]**: Sサービスが認可コード(d)と引き換えにTサービスから取得する、リソースアクセスに使用するトークンです。これは**アクセストークン**です (図2の(く)に対応)。→ イ\n\n**解答:** d: ウ, e: イ",
          "point": 10
        },
        {
          "label": "(2)",
          "text": "本文中の下線②について、ファイルのアップロードと、ファイルのダウンロードは、それぞれTサービスの誰のアカウントによって行われるか。それぞれ6字以内で答えよ。",
          "explanation": "### 解説\n下線②は「利用者が攻撃を受けているとは知らずにSサービスにファイルをアップロード」する操作です。これは**利用者**自身が行います。\n攻撃の目的は、アップロードされたファイルを攻撃者がダウンロードすることですが、攻撃者はシーケンスXによって利用者の権限を乗っ取っているため、Sサービスは当該操作を**利用者**アカウントの権限で行おうとします。\n\n**解答:** アップロード: 利用者, ダウンロード: 利用者",
          "point": 10
        },
        {
          "label": "(3)",
          "text": "本文中の [ β ], [ γ ] に入れる適切な字句を、図2中の(あ)~(こ)から選び、記号で答えよ。",
          "explanation": "### 解説\nstateパラメータはCSRF対策として、クライアント（Sサービス）が認可リクエストを開始する際に発行し、認可レスポンスを受け取る際に検証します。\n\n1.  **[ β ] (送信する際)**: Sサービスが認可サーバーTに認可を要求する際です。図2の **(い) 認可の要求** が該当します。\n2.  **[ γ ] (受信する際)**: 認可コードをリダイレクト経由で受け取る際です。図2の **(か) 認可コード** を受け取る際に、stateパラメータも併せて確認します。\n\n**解答:** β: (い), γ: (か)",
          "point": 10
        }
      ],
      "subCategory": "その他"
    },
    {
      "subQNo": "設問3",
      "text": "〔二つ目と三つ目の問題〕について、(1), (2)に答えよ。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "本文中の下線③について、必要最小限の権限を図3中の(ア)~(エ)から一つ選び、記号で答えよ。",
          "explanation": "### 解説\n下線③は「S サービスがTサービスに要求する権限が必要最小限のものになっていないこと」です。SサービスがTサービスとのID連携を行う目的は、新規S会員の登録と認証です。この目的を達成するために必要な最小限の権限は、Tサービス側で利用者を一意に識別し、Sサービスに登録するための情報（アカウント名、メールアドレスなど）を取得する権限です。\nこれは **(エ) 利用者のアカウント名、電子メールアドレスなど登録情報を取得する権限** に該当します。\n\n**解答:** (エ)",
          "point": 10
        },
        {
          "label": "(2)",
          "text": "本文中の下線④に該当するS会員を、35字以内で述べよ。",
          "explanation": "### 解説\nTサービスに脆弱性が報告された際、S社はID連携を一時的に停止し、S認証モジュールのみを稼働させました。S認証モジュールは**既存のS会員**のために継続稼働させているものであり、ID連携でのみ登録した新規S会員はS認証モジュールによる認証情報を持っていません。したがって、利用できなくなるのは、ID連携でのみ登録した会員です。\n\n**解答:** TサービスとのID連携でのみ登録した新規登録のS会員",
          "point": 10
        }
      ],
      "subCategory": "その他"
    },
    {
      "subQNo": "設問4",
      "text": "本文中の下線⑤について、Sサービスは、Tサービスと連携して、どのように利用者認証を実現しているか。実現の方法を50字以内で具体的に述べよ。",
      "explanation": "### 解説\nSサービスは利用者自身を直接認証していません。OAuthのフロー（図2）を利用し、Tサービス側で認証が行われた結果として得られる利用者のアカウント情報（T-ID）を利用して、Sサービス内の登録情報と紐づけています。\n\n図2の注記にある通り、Sサービスは初回利用時にTサービスから取得したアカウント名(T-ID)をSサービス内に登録し、2回目以降は、TサービスからT-IDを取得し、初回登録されたT-IDと照合することで利用者認証を実現しています。\n\n**解答:** Tサービスで認証された利用者のアカウント名(T-ID)を取得し、Sサービス内に登録済みのT-IDと照合することで認証を実現している。",
      "point": 10,
      "subCategory": "その他"
    }
  ]
}