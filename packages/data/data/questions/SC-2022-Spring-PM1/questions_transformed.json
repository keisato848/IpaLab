{
  "questions": [
    {
      "qNo": 1,
      "theme": "Webアプリケーションの脆弱性と対策",
      "description": "HTTPヘッダインジェクション、SQLインジェクション、メールヘッダインジェクションなどのインジェクション攻撃とその対策手法に関する問題。",
      "context": {
        "title": "インジェクション攻撃対策",
        "background": "本問題は、Webアプリケーションで発生しうる主要なインジェクション攻撃に対する基本的な対策手法について問うものである。具体的な対策コードやパラメータ設定については、{{diagram:table1}} を参照して解答せよ。元データにはこの背景情報と表1の詳細が記載されていませんでしたが、設問内容に基づき再構成しました。\n\nL社は、プロジェクト管理システムを運用している。このシステムには情報選択機能があり、利用者が参加しているプロジェクトの情報リストを表示する。\n\n情報選択機能に脆弱性が見つかった。方法1では、利用者がGETリクエストのクエリ文字列 \"id=プロジェクトID\" を送信し、情報選択機能がこのIDをチェックせずに利用していた。利用者は参加していないプロジェクトのIDをこのクエリ文字列に指定することで、そのプロジェクトの情報リストを表示させることができる。 [③ 未参加のプロジェクトに参加しているかのように偽るための操作] が可能であった。\n\nこの脆弱性に対処するため、方法2が導入された。方法2は、ログインによって確立されたセッション情報から利用者情報を取得し、そこからプロジェクトIDを取得する。 [④ 方法1の脆弱性が方法2で解決される] のは、プロジェクトIDの取得元が変わるためである。\n\n情報選択機能のデータベースアクセス部分については、以下のコードを用いてSQLインジェクション対策を講じる。\n\n{{diagram:fig2}}\n\n{{diagram:fig3}}\n\nL社では、情報管理システムを運用している。このシステムは、利用者がプロジェクトに所属し、そのプロジェクトに関連付けられた情報のみを参照できるように設計されている。\n\n## 図1 情報管理テーブルの主な属性\n情報管理テーブルの主な属性は以下の通りである。\n{{diagram:fig1}}\n\n## 図3 情報表示機能 (ShowServlet) の処理概要\n情報表示機能は、以下の処理を行う。\n1. リクエストから情報番号 (`documentNo`) を取得する。\n2. 利用者のセッションからプロジェクトID (`projectId`) を取得する。\n3. 情報管理テーブルから情報を検索するSQLを実行する。\n   SQL文: `SELECT * FROM 情報管理テーブル WHERE [ d ]`\n4. 検索結果を利用者に表示する。\n{{diagram:fig3}}",
        "diagrams": [
          {
            "id": "table1",
            "label": "表1 脆弱性対策に関する設定内容（仮想）",
            "type": "markdown",
            "content": "| 箇所 | 対策内容 | 備考 |\n|:---|:---|:---|\n| 下線① | HTTPレスポンスヘッダへの出力データに含まれる改行コードを意味する文字列の削除またはエスケープ処理を行う。 | 下線①は `%0D%0A` など改行コードを表す文字列である。 |\n| 下線② | データベース操作において、SQL文のひな形の中で、後から変数の値を安全に埋め込むためのプレースホルダ『?』を使用する。 | パラメータをデータとして扱い、SQL構造の一部としない。 |\n| [ a ] | 外部入力に含まれる [ a ]（改行文字）を、メール送信処理の前に削除処理によって除去する。 | | \n\n※元の問題文には、この表1の詳細な内容が記載されていたが、入力データには含まれていないため、設問と解説に基づき内容を再構成した。"
          },
          {
            "id": "fig2",
            "label": "図2 情報選択機能の修正案 (抜粋)",
            "type": "markdown",
            "content": "// 図2: 情報選択機能の修正案 (抜粋)\nConnection con = null;\nString sql = \"SELECT * FROM projects WHERE project_id = ?\";\n// 8行目\n[ b ] stmt = con.prepareStatement(sql);\n// 9行目\n[ c ].setInt(1, projectId);\nResultSet rs = stmt.executeQuery();"
          },
          {
            "id": "fig3",
            "label": "図3 別の箇所での修正案 (抜粋)",
            "type": "markdown",
            "content": "// 図3: 別の箇所での修正案 (抜粋)\n// データベース接続 con は確立済み\nString sql = \"SELECT * FROM tasks WHERE project_id = ?\";\n// 8行目\n[ b ] stmt = con.prepareStatement(sql);"
          },
          {
            "id": "fig1",
            "label": "図1 情報管理テーブルの主な属性",
            "type": "markdown",
            "content": "| 属性名 | 説明 |\n|---|---|\n| 情報番号 | 情報識別子 (PK) |\n| プロジェクトID | 関連するプロジェクトの識別子 |"
          },
          {
            "id": "fig3",
            "label": "図3 情報表示機能 (ShowServlet) の処理概要",
            "type": "markdown",
            "content": "情報表示機能の処理の一部。\n\n1. リクエストから `documentNo` を取得。\n2. 利用者のセッションから `projectId` を取得。\n3. 以下のSQLを実行:\n   `SELECT ... FROM 情報管理テーブル WHERE [ d ]`\n4. 結果を利用者へ表示。"
          }
        ]
      },
      "questions": [
        {
          "subQNo": "設問1",
          "text": "表1について、(1)~(3)に答えよ。\n(1) 表1中の下線①について、適切な文字列の例を、解答群の中から選び、記号で答えよ。\n解答群: ア %0D%0A, イ %20, ウ <br>, エ <p>\n(2) 表1中の下線②について、名称を,10字以内で答えよ。\n(3) 表1中の [ a ] に入れる適切な字句を,5字以内で答えよ。",
          "references": [
            "table1"
          ],
          "subQuestions": [
            {
              "label": "(1)",
              "text": "表1中の下線①について、適切な文字列の例を、解答群の中から選び、記号で答えよ。",
              "answer": "ア",
              "explanation": "### HTTP ヘッダインジェクション対策\n下線①は、HTTPヘッダインジェクションを試みるための「改行コードを意味する文字列」です。\nHTTPレスポンスヘッダにおいて、現在のヘッダ行を強制的に終了させ、新しいヘッダ行（またはコンテンツ本文）を挿入するためには、改行コード（CR: Carriage Return, LF: Line Feed）が必要です。\nURLエンコーディングでは、CRは `%0D`、LFは `%0A` と表現されます。したがって、改行コードを意味する文字列は、`%0D%0A` です。\n\n解答: ア"
            },
            {
              "label": "(2)",
              "text": "表1中の下線②について、名称を,10字以内で答えよ。",
              "answer": "プレースホルダ",
              "explanation": "### SQLインジェクション対策\n下線②の記号『?』は、SQL文のひな形の中で、後から変数の値を安全に埋め込むための場所を示す記号です。\nこの記号は通常「プレースホルダ」または「パラメータマーカ」と呼ばれます。これにより、データとSQLコマンドの構造を分離し、SQLインジェクションを防ぐことができます。10字以内という制限から、「プレースホルダ」が適切です。\n\n解答: プレースホルダ"
            },
            {
              "label": "(3)",
              "text": "表1中の [ a ] に入れる適切な字句を,5字以内で答えよ。",
              "answer": "改行文字",
              "explanation": "### メールヘッダインジェクション対策\nメールヘッダインジェクションは、利用者の入力データに改行文字を混ぜることで、意図しないメールヘッダ（例：To, Cc, Bcc）を追加してしまう攻撃です。\n対策として、外部からの入力に含まれる全ての改行文字を削除することが有効です。5字以内の適切な字句は「改行文字」です。\n\n解答: 改行文字"
            }
          ],
          "point": 33
        },
        {
          "subQNo": "設問2",
          "text": "〔情報選択機能の脆弱性〕について、(1)~(4)に答えよ。",
          "references": [
            "fig2",
            "fig3"
          ],
          "subQuestions": [
            {
              "label": "(1)",
              "text": "本文中の下線③について、未参加のプロジェクトに参加しているかのように偽るための操作を,40字以内で具体的に述べよ。",
              "answer": "他のプロジェクトIDをクエリ文字列(id=X)に指定して、情報選択機能にアクセスする。",
              "explanation": "方法1では、利用者がGETリクエストのクエリ文字列 \"id=プロジェクトID\" を送信し、情報選択機能がこのIDをチェックせずに利用していました。利用者は参加していないプロジェクトのIDをこのクエリ文字列に指定することで、そのプロジェクトの情報リストを表示させることができます。"
            },
            {
              "label": "(2)",
              "text": "本文中の下線④について,方法1の脆弱性が方法2で解決されるのはなぜか。30字以内で述べよ。",
              "answer": "プロジェクトIDをセッション情報から取得するため、利用者が不正にIDを操作できないから。",
              "explanation": "方法1はクライアントから提供される信頼できない情報（クエリ文字列）をプロジェクトIDとして利用していました。方法2は、ログインによって確立されたセッション情報（サーバ側で管理されている情報）から利用者情報を取得し、そこからプロジェクトIDを取得します。"
            },
            {
              "label": "(3)",
              "text": "図2中及び図3中の [ b ] に入れる適切な字句を、解答群の中から選び、記号で答えよ。\n解答群: ア Connection, イ DriverManager, ウ PreparedStatement, エ Statement",
              "answer": "ウ",
              "explanation": "図2および図3は、プリペアドステートメント（パラメータ化クエリ）を用いてSQLを実行しているコードです。8行目では、con.prepareStatement(sql) を呼び出しています。このメソッドは、SQL文をプリコンパイルしたオブジェクトを返します。JavaのJDBCにおいて、このオブジェクトの型は java.sql.PreparedStatement です。"
            },
            {
              "label": "(4)",
              "text": "図2中の [ c ] に入れる適切な字句を答えよ。",
              "answer": "stmt",
              "explanation": "図2の9行目では、[ c ].setInt(1, projectId) となっており、これは8行目で宣言された stmt オブジェクトのメソッドを呼び出して、SQL文のプレースホルダ（1番目）に projectId の値を設定しています。したがって、[ c ] には stmt が入ります。"
            }
          ],
          "point": 33
        },
        {
          "subQNo": "設問3",
          "text": "図3中の [ d ] に入れる適切な字句を、図1中の属性名を含めて答えよ。",
          "references": [
            "fig1",
            "fig3"
          ],
          "answer": "情報番号 = ? AND プロジェクトID = ?",
          "explanation": "図3の情報表示機能 (ShowServlet) は、利用者が選択した情報番号 (`documentNo`) の情報と、利用者が参加しているプロジェクトID (`projectId`) に関連付けられた情報のみを表示する必要があります。\n\nSQL文は `SELECT ... FROM 情報管理テーブル WHERE [ d ]` となっており、`WHERE` 句で2つの条件を結合する必要があります。\n\n1. 情報番号がリクエストされた番号 (`documentNo`) と一致する。\n2. プロジェクトIDが利用者のプロジェクトID (`projectId`) と一致する。\n\nこの両方を満たすように、図1の属性名である『情報番号』と『プロジェクトID』を用いて、プリペアドステートメントの形式で条件を指定します。",
          "point": 33
        }
      ]
    }
  ]
}