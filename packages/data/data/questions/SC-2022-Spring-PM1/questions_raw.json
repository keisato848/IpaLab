{
  "qNo": 1,
  "theme": "Webアプリケーションプログラム開発のセキュリティ対策",
  "description": "H社は、Webアプリケーションプログラム(以下, Web アプリという)を開発する従業員200名の会社である。H社では、開発部が Web アプリを開発し、情報セキュリティ部が,表1に示す方法に従って,脆弱性検査を実施する。\n\n## 表1 脆弱性検査の方法(抜粋)\n| 項番 | 脆弱性 | 検査の方法 | 脆弱性が検出された場合の対策方法 |\n|:---|:---|:---|:---|\n| 1 | HTTP ヘッダインジェクション | 利用者の入力を基に HTTP レスポンスヘッダを生成する処理において、①改行コードを意味する文字列を入力したときに、HTTP ヘッダフィールドが追加されないことを確認する。 (省略) | (省略) |\n| 2 | SQL インジェクション | (省略) | SQL 文の組立てにおいて、SQL 文のひな形の中に②変数の場所を示す? 記号を置く技法を利用する。 |\n| 3 | メールヘッダインジェクション | (省略) | 次のいずれかの対策を実施する。(1) メールヘッダを固定値にする。(2) 外部からの入力を適切に処理するメール送信用 APIを使用する。(3) 外部からの入力の全てについて、[ a ]を削除する。 |\n\n開発部では、自部で開発したSシステムという Web システムを利用して、コーディングルールなどの社内ルールを含む各種の情報を共有している。Sシステムの利用者は、ログイン後に情報の投稿と表示を行うことができる。投稿された情報はデータベースに格納される。\n\nログインから情報表示までのSシステムの画面遷移を表2に示す。\n\n## 表2 ログインから情報表示までのSシステムの画面遷移\n| 項番 | 利用者の操作 | 操作の結果 |\n|:---|:---|:---|\n| 1 | Sシステムのログイン画面にアクセスし、利用者 IDとパスワードを入力する。 | ログインが成功すると、次の画面がWeb ブラウザに表示される。なお、下線はリンクであることを示している。URL https://(省略)/menu。・情報の投稿・情報の表示(省略) |\n| 2 | 表示された画面の“情報の表示”をクリックする。 | “情報選択機能”が呼び出され、次の画面が Web ブラウザに表示される。プルダウンには、表示できる情報の情報番号と情報名がリストされる。URL https://(省略)/select。表示したい情報の情報番号,情報名を選んでください。[プルダウンメニュー: 番号 1001 コーディングルール... 表示ボタン] |\n| 3 | プルダウンから表示したい情報を選択し、“表示”ボタンをクリックする。 | “情報表示機能”が呼び出され、次の画面注1)が Web ブラウザに表示される。URL https://(省略)/show?no=1001。番号1001 コーディングルール(省略) |\n\n注記 利用者のログイン後、セッション ID でセッション管理を行っている。セッションIDは、ログイン時に発行される推測困難な値であり, secure 属性が付与された cookieに格納される。\n注1) プルダウンから、表示したい情報として“番号 1001 コーディングルール”を選択した場合を示している。\n\n## Sシステムの改修におけるアクセス制御要件の追加\n開発部で新しいプロジェクトを立ち上げることになり、開発部の各プロジェクト内の情報共有を強化することにした。開発部は、次のようにSシステムを改修する方針とした。\n・社内ルールだけでなく、各プロジェクトの計画書や各種の設計情報を各プロジェクト内で共有できるようにする。\n・各プロジェクトの計画書や各種の設計情報については、情報が表示できる利用者を、情報の作成者と同じプロジェクトに参加する利用者に限定できるようにする。\n\nなお,開発部員は、一時期には一つのプロジェクトだけに参加する。同時に複数のプロジェクトには参加しない。\n開発部のDさんが、Sシステム改修の担当者に任命され、利用者のアクセス制御を次のように設計した。\n・プロジェクトを識別するプロジェクトIDを連番で採番する。\n・利用者 ID それぞれに対して、その利用者が参加するプロジェクトのプロジェクトIDを登録しておく。\n・S システムに格納される各情報に、作成者の参加するプロジェクトを示すプロジェクトIDをあらかじめ付与しておく。\n・プロジェクトIDを次に示す方法で取得し、そのプロジェクトIDを用いてアクセス制御する。\n\n**方法1:** ログイン時にその利用者IDに対して登録されているプロジェクトIDを取得し、GET リクエストのクエリ文字列に、“id=プロジェクト ID”の形式で指定する。情報選択機能は、クエリ文字列からプロジェクト ID を取得する。\n\n## 情報選択機能の脆弱性\nS システム改修後の脆弱性検査で、情報セキュリティ部は、プロジェクトの情報番号と情報名を、そのプロジェクトには参加していない利用者が, ③そのプロジェクトに参加しているかのように偽ってリスト可能であるという脆弱性を指摘した。これは、情報選択機能においてクエリ文字列で受け取ったプロジェクト ID をチェックせずに利用していることに起因していた。この指摘を受けて、Dさんは、プロジェクトIDの取得方法として、次に示す別の方法を提示した。\n\n**方法2:** 情報選択機能の利用時に、セッション情報から利用者情報を取得する。情報選択機能は、当該利用者情報からプロジェクトIDを取得する。\n\n情報セキュリティ部は、④方法1の脆弱性が方法2で解決されることを確認した。Dさんは、プロジェクトIDの取得方法を方法2に修正した。\n\n「情報選択機能及び情報表示機能が参照するデータベースのE-R図を図1に、修正後の情報選択機能のソースコードを図2に示す。\n\n## 図1 参照するデータベースのE-R図\n```mermaid\nerDiagram\n    利用者テーブル {\n        利用者ID UID\n        プロジェクトID FK\n    }\n    プロジェクト管理テーブル {\n        プロジェクトID UID\n        プロジェクト名\n    }\n    情報管理テーブル {\n        情報番号 UID\n        プロジェクトID FK\n        情報名\n        情報内容\n    }\n\n    プロジェクト管理テーブル ||--o{ 利用者テーブル : 参加\n    プロジェクト管理テーブル ||--o{ 情報管理テーブル : 関連\n```\n\n## 図2 修正後の情報選択機能のソースコード\n```java\n(省略) // package宣言, import宣言など\n1: public class SelectServlet extends HttpServlet {\n(省略) //変数の宣言やメソッドの定義など\n2: protected void doGet(HttpServletRequest request, HttpServletResponse response)\n   throws ServletException, IOException {\n3:     java.sql.Connection con = null;\n4:     try {\n(省略) //初期化処理など\n5:         con = java.sql.DriverManager.getConnection((省略)); // データベースに接続する処理\n6:         int projectId = (省略); // 利用者の参加プロジェクトのプロジェクトIDを利用者テーブルから取得し、代入する処理\n7:         String sql = \"SELECT 情報番号,情報名 FROM 情報管理テーブル WHERE プロジェクトID = ?\";\n8:         java.sql. [ b ] stmt = con.prepareStatement(sql);\n9:         [ c ].setInt(1, projectId);\n10:        java.sql.ResultSet rs = stmt.executeQuery();\n(省略) //例外処理やその他の処理\n```\n\n## 情報表示機能の脆弱性\n情報セキュリティ部は、情報表示機能にも情報選択機能と同様の脆弱性があることを指摘した。Dさんは、情報表示機能にも同様の修正を行った。修正後の情報表示機能のソースコードを図3に示す。\n\n## 図3 修正後の情報表示機能のソースコード\n```java\n(省略) // package宣言, import宣言など\n1: public class ShowServlet extends HttpServlet {\n(省略) //変数の宣言やメソッドの定義など\n2: protected void doGet(HttpServletRequest request, HttpServletResponse response)\n   throws ServletException, IOException {\n3:     int documentNo = Integer.parseInt(request.getParameter(\"no\"));\n4:     java.sql.Connection con = null;\n5:     try {\n(省略) //初期化処理など\n6:         con = java.sql.DriverManager.getConnection((省略)); // データベースに接続する処理\n7:         int projectId = (省略); // 利用者の参加プロジェクトのプロジェクトIDを利用者テーブルから取得し、代入する処理\n8:         String sql = \"SELECT 情報番号,情報名,情報内容 FROM 情報管理テーブル WHERE [ d ]\";\n9:         java.sql. [ b ] stmt = con.prepareStatement(sql);\n(省略) // SQL文のひな型に変数を代入する処理\n10:        java.sql.ResultSet rs = stmt.executeQuery();\n(省略) // 例外処理やその他の処理\n```\n注記 10行目より後の(省略)に、projectId, documentNoを用いた処理はない。\n\n情報セキュリティ部による脆弱性検査に合格後, Sシステムの改修版がリリースされ、各プロジェクト内の情報共有が強化された。",
  "questions": [
    {
      "subQNo": "設問1",
      "text": "表1について、(1)~(3)に答えよ。\n(1) 表1中の下線①について、適切な文字列の例を、解答群の中から選び、記号で答えよ。\n解答群: ア %0D%0A, イ %20, ウ <br>, エ <p>\n(2) 表1中の下線②について、名称を,10字以内で答えよ。\n(3) 表1中の [ a ] に入れる適切な字句を,5字以内で答えよ。",
      "explanation": "### (1) HTTP ヘッダインジェクション対策\n下線①は、HTTPヘッダインジェクションを試みるための「改行コードを意味する文字列」です。\nHTTPレスポンスヘッダにおいて、現在のヘッダ行を強制的に終了させ、新しいヘッダ行（またはコンテンツ本文）を挿入するためには、改行コード（CR: Carriage Return, LF: Line Feed）が必要です。\nURLエンコーディングでは、CRは `%0D`、LFは `%0A` と表現されます。したがって、改行コードを意味する文字列は、`%0D%0A` です。\n**解答群:** ア\n\n### (2) SQLインジェクション対策\n下線②の記号『?』は、SQL文のひな形の中で、後から変数の値を安全に埋め込むための場所を示す記号です。\nこの記号は通常「プレースホルダ」または「パラメータマーカ」と呼ばれます。これにより、データとSQLコマンドの構造を分離し、SQLインジェクションを防ぐことができます。10字以内という制限から、「プレースホルダ」が適切です。\n**解答:** プレースホルダ\n\n### (3) メールヘッダインジェクション対策\nメールヘッダインジェクションは、利用者の入力データに改行文字を混ぜることで、意図しないメールヘッダ（例：To, Cc, Bcc）を追加してしまう攻撃です。\n対策として、外部からの入力に含まれる全ての改行文字を削除することが有効です。5字以内の適切な字句は「改行文字」です。\n**解答:** 改行文字",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "表1中の下線①について、適切な文字列の例を、解答群の中から選び、記号で答えよ。",
          "answer": "ア",
          "point": 13
        },
        {
          "label": "(2)",
          "text": "表1中の下線②について、名称を,10字以内で答えよ。",
          "answer": "プレースホルダ",
          "point": 13
        },
        {
          "label": "(3)",
          "text": "表1中の [ a ] に入れる適切な字句を,5字以内で答えよ。",
          "answer": "改行文字",
          "point": 13
        }
      ],
      "subCategory": "その他"
    },
    {
      "subQNo": "設問2",
      "text": "〔情報選択機能の脆弱性〕について、(1)~(4)に答えよ。\n(1) 本文中の下線③について、未参加のプロジェクトに参加しているかのように偽るための操作を,40字以内で具体的に述べよ。\n(2) 本文中の下線④について,方法1の脆弱性が方法2で解決されるのはなぜか。30字以内で述べよ。\n(3) 図2中及び図3中の [ b ] に入れる適切な字句を、解答群の中から選び、記号で答えよ。\n解答群: ア Connection, イ DriverManager, ウ PreparedStatement, エ Statement\n(4) 図2中の [ c ] に入れる適切な字句を答えよ。",
      "explanation": "### (1) 不正操作の具体的内容\n方法1では、利用者がGETリクエストのクエリ文字列 `id=プロジェクトID` を送信し、情報選択機能がこのIDをチェックせずに利用していました。利用者は参加していないプロジェクトのIDをこのクエリ文字列に指定することで、そのプロジェクトの情報リストを表示させることができます。\n**解答:** 他のプロジェクトIDをクエリ文字列(id=X)に指定して、情報選択機能にアクセスする。\n\n### (2) 方法2で脆弱性が解決される理由\n方法1はクライアントから提供される信頼できない情報（クエリ文字列）をプロジェクトIDとして利用していました。方法2は、ログインによって確立されたセッション情報（サーバ側で管理されている情報）から利用者情報を取得し、そこからプロジェクトIDを取得します。\nこれにより、利用者が勝手にプロジェクトIDを偽装することが不可能になります。\n**解答:** プロジェクトIDをセッション情報から取得するため、利用者が不正にIDを操作できないから。\n\n### (3) bに入る字句\n図2および図3は、プリペアドステートメント（パラメータ化クエリ）を用いてSQLを実行しているコードです。\n8行目では、`con.prepareStatement(sql)` を呼び出しています。このメソッドは、SQL文をプリコンパイルしたオブジェクトを返します。JavaのJDBCにおいて、このオブジェクトの型は `java.sql.PreparedStatement` です。\n**解答群:** ウ\n\n### (4) cに入る字句\n図2の9行目では、`[ c ].setInt(1, projectId)` となっており、これは8行目で宣言された `stmt` オブジェクトのメソッドを呼び出して、SQL文のプレースホルダ（1番目）に `projectId` の値を設定しています。\nしたがって、[ c ] には `stmt` が入ります。\n**解答:** stmt",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "本文中の下線③について、未参加のプロジェクトに参加しているかのように偽るための操作を,40字以内で具体的に述べよ。",
          "answer": "他のプロジェクトIDをクエリ文字列(id=X)に指定して、情報選択機能にアクセスする。",
          "point": 13
        },
        {
          "label": "(2)",
          "text": "本文中の下線④について,方法1の脆弱性が方法2で解決されるのはなぜか。30字以内で述べよ。",
          "answer": "プロジェクトIDをセッション情報から取得するため、利用者が不正にIDを操作できないから。",
          "point": 12
        },
        {
          "label": "(3)",
          "text": "図2中及び図3中の [ b ] に入れる適切な字句を、解答群の中から選び、記号で答えよ。",
          "answer": "ウ",
          "point": 12
        },
        {
          "label": "(4)",
          "text": "図2中の [ c ] に入れる適切な字句を答えよ。",
          "answer": "stmt",
          "point": 12
        }
      ],
      "subCategory": "その他"
    },
    {
      "subQNo": "設問3",
      "text": "図3中の [ d ] に入れる適切な字句を、図1中の属性名を含めて答えよ。",
      "explanation": "図3の情報表示機能 (ShowServlet) は、利用者が選択した情報番号 (`documentNo`) の情報と、利用者が参加しているプロジェクトID (`projectId`) に関連付けられた情報のみを表示する必要があります。\n\nSQL文は `SELECT ... FROM 情報管理テーブル WHERE [ d ]` となっており、`WHERE` 句で2つの条件を結合する必要があります。\n\n1. 情報番号がリクエストされた番号 (`documentNo`) と一致する。\n2. プロジェクトIDが利用者のプロジェクトID (`projectId`) と一致する。\n\nこの両方を満たすように、図1の属性名である『情報番号』と『プロジェクトID』を用いて、プリペアドステートメントの形式で条件を指定します。\n\n**解答:** 情報番号 = ? AND プロジェクトID = ?",
      "subQuestions": [
        {
          "label": "",
          "text": "図3中の [ d ] に入れる適切な字句を、図1中の属性名を含めて答えよ。",
          "answer": "情報番号 = ? AND プロジェクトID = ?",
          "point": 12
        }
      ],
      "subCategory": "その他"
    }
  ]
}