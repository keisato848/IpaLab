{
  "questions": [
    {
      "qNo": 1,
      "theme": "Webコンテンツセキュリティポリシー（CSP）",
      "description": "提供された入力データには大問の本文が不足していたため、設問1の解説文から逆算して、CSPに関する問題としてコンテキストを仮定し構造化しました。",
      "context": {
        "title": "Content Security Policy (CSP) の設定と効果",
        "background": "L社は自社が提供するSサービスについてセキュリティ診断を実施し、その結果に基づいてContent Security Policy (CSP) を導入することを決定した。以下の設定が施されたHTTPレスポンスヘッダーが出力されるようになった。\n\n{{diagram:fig1}}\n\n（元の問題文の背景情報が提供されていません。設問の参照から、図1〜図4、表1、および下線①が存在したことが推測されます。）\n\nこの設問を解くために必要な背景情報（本文、図表）は提供されていません。\n\nこの設問を解くために必要な本文（[ j ] を含む記述）は提供されていません。設問4のコンテキストは、診断ツールX（DAST）やSAST（静的解析）といった自動化された手法では検出が難しい、ロジックの欠陥や複雑な攻撃経路を特定するための検査方法に関するものです。",
        "diagrams": [
          {
            "id": "fig1",
            "label": "SサービスのHTTPレスポンスヘッダー（一部）",
            "type": "markdown",
            "content": "| フィールド名 | 値 |\n| :--- | :--- |\n| Content-Security-Policy | default-src 'self'; |"
          },
          {
            "id": "table1",
            "label": "表1 Sサービスの主な機能（仮）",
            "type": "image",
            "content": "内容不明。ロール管理、タスク管理、プロジェクト進捗管理に関する情報を含むと推定される。"
          },
          {
            "id": "fig2",
            "label": "図2 Sサービスのある画面のHTMLソース（仮）",
            "type": "image",
            "content": "内容不明。XSSを発生させたHTMLソース部分を含むと推定される。"
          },
          {
            "id": "fig3",
            "label": "図3 元従業員Zが作成したスクリプト（仮）",
            "type": "image",
            "content": "内容不明。CSRF攻撃に使用されたスクリプトを含むと推定される。"
          },
          {
            "id": "fig4",
            "label": "図4 ログから推定した攻撃シーケンス（仮）",
            "type": "image",
            "content": "内容不明。攻撃者が踏んだ手順（c, d, e, f, gの空欄を含む）を示すと推定される。"
          }
        ]
      },
      "questions": [
        {
          "subQNo": "設問1",
          "text": "本文中の [ a ], [ b ] に入れる適切な字句を、“できる”,“できない”のいずれかでそれぞれ答えよ。",
          "references": [
            "fig1"
          ],
          "explanation": "図1のHTTPレスポンスヘッダーに含まれるCSPの設定は `Content-Security-Policy: default-src 'self';` です。\n\n1. Sサービス以外のドメインからのリソースの読込み ([ a ])\n   `default-src 'self'` は、リソースの読み込み元を自身のオリジンに限定します。外部ドメインからの読み込みは許可されません。\n2. script タグ内に直接記述されたスクリプトの実行 ([ b ])\n   `default-src 'self'` のみでは、インラインスクリプトの実行は許可されません。",
          "subQuestions": [
            {
              "label": "a",
              "text": "Sサービス以外のドメインからのリソースの読込み",
              "answer": "できない"
            },
            {
              "label": "b",
              "text": "script タグ内に直接記述されたスクリプトの実行",
              "answer": "できない"
            }
          ],
          "point": 25
        },
        {
          "subQNo": "設問2",
          "text": "〔インシデントの発生とその調査〕について答えよ。",
          "references": [],
          "subQuestions": [
            {
              "label": "(1)",
              "text": "図3のスクリプトは、表1中のどの機能を悪用するものか。機能名を答えよ。",
              "references": [
                "fig3",
                "table1"
              ],
              "answer": "ロール管理",
              "explanation": "図3のスクリプトは、CSRFトークンを取得後、`/management/roleset` に対してPOSTリクエストを送信し、元従業員Zのロールを管理者 (`is_admin: \"1\"`) に変更しようとしています。これは表1の**ロール管理**機能に対応します。\n\n**答え**: ロール管理"
            },
            {
              "label": "(2)",
              "text": "図4中の [ c ] に入れる適切なタスクの項目を、表1中の字句を用いて答えよ。",
              "references": [
                "fig4",
                "table1"
              ],
              "answer": "タスク名",
              "explanation": "図2のHTMLの構造から、悪意のあるスクリプトタグはタスクの名称部分に埋め込まれています。表1のタスク管理の項目名は**タスク名**です。\n\n**c の答え**: タスク名"
            },
            {
              "label": "(3)",
              "text": "図4中の [ d ] に入れる適切な文字列を、図2から抜き出して答えよ。",
              "references": [
                "fig4",
                "fig2"
              ],
              "answer": "個人タスク<script src=\"/files/F1234567890.xlsx\"></script>",
              "explanation": "図2のHTMLにおいて、タスク名として表示され、XSSを引き起こした文字列は、締切日情報の手前にある `<script>` タグを含む部分です。\n\n**d の答え**: 個人タスク<script src=\"/files/F1234567890.xlsx\"></script>"
            },
            {
              "label": "(4)",
              "text": "図4中の [ e ] ~ [ g ] に入れる適切な字句を答えよ。",
              "references": [
                "fig4",
                "table1"
              ],
              "answer": "e: 管理者; f: 締切日を過ぎている; g: ロールが管理者に変更された",
              "explanation": "攻撃はロール管理機能を悪用しており、ロール変更権限を持つユーザーが被害者となる必要があります。また、タスクが表示される条件が関係しています。\n\n*   **e**: ロール変更権限を持つユーザー、すなわち**管理者**です。\n*   **f**: 表1のプロジェクト進捗管理の備考より、表示されるタスクの条件は「未完了の状態で,かつ, **締切日を過ぎている**」ものです。\n*   **g**: 図3のスクリプトの目的は、元従業員Z (U00331001) のロールを管理者 (`is_admin: \"1\"`) に変更することです。\n\n**e の答え**: 管理者\n**f の答え**: 締切日を過ぎている\n**g の答え**: ロールが管理者に変更された"
            },
            {
              "label": "(5)",
              "text": "本文中の下線①について、工夫の内容を、具体的に答えよ。",
              "references": [
                "underline1"
              ],
              "answer": "インラインスクリプトではなく、Sサービスのファイルアップロード機能を利用して悪意のあるスクリプトをアップロードし、そのファイルパスを`script src`属性に指定する形式に変更したこと。",
              "explanation": "失敗した攻撃ではインラインスクリプトを使用したため、CSP（`default-src 'self'`）によってブロックされました。成功した攻撃では、スクリプトの内容をSサービス内にアップロードされたファイルに記述し、それを`script src`属性で読み込む形式に変更しました。これにより、Sサービス自身のオリジンからのリソース読み込みとしてCSPを回避しました。\n\n**答え**: インラインスクリプトではなく、Sサービスのファイルアップロード機能を利用して悪意のあるスクリプトをアップロードし、そのファイルパスを`script src`属性に指定する形式に変更したこと。"
            }
          ],
          "point": 25
        },
        {
          "subQNo": "設問3",
          "text": "〔インシデントへの対応及び攻撃への対策〕について答えよ。",
          "references": [],
          "subQuestions": [
            {
              "label": "(1)",
              "text": "本文中の [ h ] に入れる追加すべき処理の内容を、具体的に答えよ。",
              "answer": "アップロードされたファイルの内容を検査し、拡張子に対応する MIME タイプ (Content Type) が適切であるかを確認すること。",
              "explanation": "ファイルアップロード時に拡張子が `.xlsx` であることはチェックされていますが、攻撃者は拡張子を詐称しました。対策として、ファイルの拡張子だけでなく、その内容が拡張子に見合った形式（MIMEタイプなど）であるかを検証する処理が必要です。"
            },
            {
              "label": "(2)",
              "text": "本文中の [ i ] に入れる適切な機能名を答えよ。",
              "answer": "プロジェクト進捗管理",
              "explanation": "XSSが発生したのは、タスク名がHTMLエスケープされずに表示されたプロジェクト進捗管理画面です。"
            },
            {
              "label": "(3)",
              "text": "本文中の下線②について、追加すべき処理の内容を、具体的に答えよ。",
              "answer": "プロジェクト進捗管理画面にタスク名などの利用者が入力した文字列を出力する際、HTMLエスケープ処理を行うこと。",
              "explanation": "XSSを防ぐためには、利用者が入力した文字列（タスク名など）をHTMLに出力する際、特殊文字を無害化するHTMLエスケープ処理が必要です。"
            }
          ],
          "point": 25
        },
        {
          "subQNo": "設問4",
          "text": "本文中の [ j ] に入れる適切な検査方法を、具体的に答えよ。",
          "references": [],
          "answer": "ペネトレーションテスト",
          "explanation": "診断ツールX（DAST）で検知されない脆弱性を補完するために、SAST（静的解析）と合わせて実施すべき検査として、ロジックの欠陥や複数の機能を組み合わせた複雑な攻撃経路を検出できる、より深いテストが必要です。これは、攻撃者視点での検証を行うペネトレーションテストが適切です。",
          "point": 25
        }
      ],
      "point": 25
    }
  ]
}