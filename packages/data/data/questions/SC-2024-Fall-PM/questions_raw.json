{
  "qNo": 1,
  "theme": "インシデントレスポンスに関する次の記述を読んで、設問に答えよ。",
  "description": "L社は、従業員 100名のソフトウェア開発会社である。L社の社内システムは、情報システム部(以下,情シス部という)が、運用及びインシデント対応を行っている。L社は、E社のSaaS を使用している。L社のネットワーク構成を図1に、図1の各構成要素の仕様,機能及び利用方法を表1に示す。\n\n## 図1 L社のネットワーク構成(抜粋)\n\n```mermaid\ngraph TD\n    A[AP]\n    T[シンクライアントPC]\n    F[FW]\n    L3SW[L3SW]\n    M[保守用PC]\n    BS[バックアップサーバ]\n    DS[ドメインサーバ]\n    FS[ファイルサーバ]\n    \n    subgraph E社 SaaS\n        P[プロキシサービス]\n        ML[マルウェア対策サービス]\n        MS[メールサービス]\n        DN[DNSサービス]\n    end\n    \n    subgraph L社\n        subgraph オフィスLAN\n            L2SW_O[L2SW]\n            A --- L2SW_O\n            T --- L2SW_O\n        end\n        \n        subgraph 仮想環境LAN\n            L2SW_V[L2SW]\n            VE[仮想環境]\n        end\n        \n        subgraph サーバLAN\n            L2SW_S[L2SW]\n            DS --- L2SW_S\n            FS --- L2SW_S\n        end\n        \n        subgraph サポートLAN\n            L2SW_Sup[L2SW]\n            BS --- L2SW_Sup\n            M --- L2SW_Sup\n        end\n        \n        F --- L3SW\n        L3SW --- L2SW_O\n        L3SW --- L2SW_V\n        L3SW --- L2SW_S\n        L3SW --- L2SW_Sup\n        \n        L2SW_V --- VE\n    end\n    \n    Internet[インターネット] --- F\n    Internet --- P\n    \n    subgraph 仮想環境\n        VS[仮想スイッチ]\n        VPC[仮想PC]\n        VE --> VS\n        VS --> VPC\n    end\n```\n\n## 表1 図1の各構成要素の仕様,機能及び利用方法(抜粋)\n\n| 構成要素 | 仕様,機能及び利用方法 |\n| :--- | :--- |\n| ドメインサーバ | ・ドメイン名 ad01 というL社の社内ドメインを管理する。 ・L社の各従業員には一つのドメインユーザーが割り当てられている。 ・ドメインユーザーが登録されており、プロキシサービス,メールサービス、L社内のサーバ、仮想PC及び保守用 PC (以下、L社内ホストという) にログオンする際の利用者認証に利用される。 ・ログオンは、ドメインユーザーの利用者 IDとパスワードで行う。 |\n| プロキシサービス | ・専用のプログラム(以下、Qプログラム”という)をL社内ホストにインストールする必要がある。Q プログラムがドメインサーバに接続され、ドメインユーザーが認証されると、利用可能になる。 ・Q プログラムがインストールされた L 社内ホストからインターネットへのHTTP 通信及び HTTPS 通信を全て中継する。 ・HTTPS 通信を復号して URL フィルタリング機能を適用し、再暗号化することができる。 ・URL フィルタリング機能では、ドメインユーザーごとに指定されたURLへのアクセスを許可又は拒否することができる。 - 次の3種類のリストがあり、上から順にURL フィルタリングが適用される。 ・管理者許可リスト: 管理者が設定できる。アクセスが許可される URL のリストである。“全て”と記載すると、全てのURLへのアクセスが許可される。何も設定しないとリストは無視される。 ・管理者拒否リスト: 管理者が設定できる。アクセスが拒否される URL のリストである。“全て”と記載すると、全てのURLへのアクセスが拒否される。何も設定しないとリストは無視される。設定されたURLへのアクセスが拒否されたときは、情シス部にアラートメールが送付されるように設定している。 ・ベンダー拒否リスト: E社から日次で提供される。アクセスが拒否される URL のリストであり、マルウェア感染などのカテゴリがある。アクセスが拒否された URL がマルウェア感染のカテゴリに一致したときは、情シス部にアラートメールが送付されるように設定している。 - どのリストにも該当しない場合は、アクセスは許可される。 ・管理用のWebページから、各種設定の変更と通信ログの確認ができる。 |\n| マルウェア対策サービス | ・L社内ホストに導入しているマルウェア対策ソフトを管理する。 ・管理用の Web ページから、各種設定の変更、マルウェア定義ファイルの適用状況の確認、マルウェア対策ソフトの稼働状況の確認及びマルウェア検知のログの確認ができる。 ・マルウェアが検知されたときは、情シス部にアラートメールが送付される。 |\n| 仮想PC | ・L社の従業員には、一人1台割り当てられている。 ・従業員がシンクライアントPCからRDPで接続して利用する。 ・従業員が利用するアカウントは、ドメインユーザーであり、仮想PC上のローカルアドミニストレーター権限をもっている。 ・各ドメインユーザーは、割り当てられた仮想PCにだけログオンできる。 ・ホスト名はPC-x\textsuperscript{注2)}である。 ・マルウェア感染が確認された場合、情シス部が仮想環境の仮想スイッチから切り離し、感染拡大を防ぐ。 |\n| ファイルサーバ | ・L社の顧客情報,設計書など、社外秘に指定されている情報(以下,社外秘情報Lという)を保管する。 ・社外秘情報Lは、仮想PCには保管せず、ファイルサーバに保管するルールにしている。 ・利用時はドメインサーバでの認証が必要である。 ・ホスト名はfilesvである。 |\n| 保守用 PC | ・L社内のサーバと仮想PCを保守するための専用のPCである。インシデント発生時は本PCで調査を行う。 ・保守用ツールのほか、ネットワークトラフィック調査及びフォレンジック用のツールがインストールされている。 |\n\n注\textsuperscript{1)} HTTP 及び HTTPS通信をプロキシサービスに送り、そのログを取得する機能をもつ。\n注\textsuperscript{2)} ×には、英大文字が1字以上入る。\n\n## [ツールの開発]\n\n情シス部のX主任とYさんは、インシデント対応時にログの調査に手間どらないように、証拠データを収集するツール(以下、Fツールという)を開発することにした。Fツールの概要を図2に示す。\n\n## 図2 Fツールの概要(抜粋)\n\n```mermaid\ngraph LR\n    subgraph Fツールの機能\n        style FTool fill:#add8e6,stroke:#333\n        VPCA[仮想PC/収集元] --> FTool[Fツール]\n        FTool --> Data[ログ, レジストリなどの証拠データ収集]\n        Data --> OutputFiles[表2の出力ファイル]\n        \n        FTool -- 指定 --> Config[設定ファイル: 収集元/保存先/出力先を指定]\n    end\n    \n    subgraph Fツールの使い方\n        VPC_ON[仮想PCが稼働]\n        VPC_ON --> Execute_VPC[仮想PC上で実行]\n        \n        VPC_OFF[仮想PCが停止]\n        VPC_OFF --> Copy_Disk[ディスクイメージを保守用PCへコピー]\n        Copy_Disk --> Mount_MaintPC[保守用PC上でマウント]\n        Mount_MaintPC --> Execute_MaintPC[保守用PC上で実行]\n    end\n```\n\n## 表2 Fツールの出力ファイル\n\n| ファイル名 | 記載される内容 |\n| :--- | :--- |\n| file.csv | ファイルの生成,参照,更新,削除及び実行のログ |\n| srv.csv | サービス及びタスク\textsuperscript{注1)}の登録,削除,開始及び停止のログ |\n| auth.csv | 認証\textsuperscript{注2)}の成功と失敗、アカウントの作成、特権の利用、イベントログの消去などのログ |\n| net1.csv | Qプログラムのログ |\n| net2.csv | プロセスごとの1時間のネットワーク送受信量の記録 |\n| time.csv | file.csv, srv.csv, auth.csv, net1.csv を結合して時刻順に並べ替えたもの |\n\n注\textsuperscript{1)} 決められたスケジュール及び指定したイベントをトリガーに実行されるプログラム\n注\textsupers焙{2)} 対話型, ネットワーク, サービス, RDPなど、ログオンの種類も記録される。\n\n## [インシデント発生時のFツール活用]\n\n12月6日,情シス部のYさんは、プロキシサービスからアラートメールを受信した。Yさんが、アラートメールを確認したところ、PC-A が、 https://OOO.com/にアクセスしようとしてアクセスが拒否されたこと及びそのURLがベンダー拒否リストのマルウェア感染のカテゴリに一致したことが分かり、上司のX主任に報告した。PC-A が割り当てられている従業員に連絡した上で、X主任は、PC-A を一旦,仮想スイッチから切り離してFツールを実行し、Fツールの出力ファイルとプロキシサービスの通信ログから, https://OOO.com/にアクセスした原因を調査するように Yさんに指示した。\n\nPC-AでのFツールの出力ファイルのうち, time.csv を表3に, net2.csvを表4に、プロキシサービスの通信ログのうち送信元がPC-Aであるものを表5に示す。\n\n...\n\n(Tables 3, 4, 5 are included in the source material but are lengthy and necessary primarily for reference and analysis.)\n\n## [暫定対策と追加調査の実施]\n\nX主任とYさんは、PC-Aがマルウェアに感染し、PC-A及び [ a ] 上のファイルのほか、[ b ] 上のファイルのうち、アカウント [ c ] でアクセス可能なファイルがインターネットに送信されているおそれがあると考え、図3の暫定対策と追加調査を行った。\n\n**暫定対策**\n1. マルウェア感染拡大とこれ以上のファイルの送信を防ぐために、ドメインサーバでアカウント [ d ] の [ d ] を行う。\n2. ファイルの送信を防ぐために、①プロキシサービスで対策を行う。\n\n**追加調査**\n1. 表3から、PC-Aから [ a ] にマルウェア感染が拡大している可能性があると考えられるので、 [ a ] について PC-Aと同様の調査を行う。\n2. プロキシサービスのログで、PC-A, [ a ] のほかに②マルウェアに感染している L社内ホストがないか調査を行う。\n\n## 図3 暫定対策と追加調査\n\n```mermaid\ngraph TD\n    A[PC-Aマルウェア感染確認] --> B{感染拡大及びファイル送信防止}; \n    B --> C1[暫定対策1: ドメインサーバでアカウント d の d を行う];\n    B --> C2[暫定対策2: ①プロキシサービスで対策を行う];\n    \n    A --> D{マルウェア拡大調査}; \n    D --> E1[追加調査1: a についてPC-Aと同様の調査];\n    D --> E2[追加調査2: PC-A, a 以外に②感染ホストがないか調査];\n```\n\nまた、X主任は PC-A の証拠データと, PC-A の調査で収集できた i.ps1 をセキュリティ専門会社であるC社に提供し、解析を依頼した。C社の解析結果を図4に示す。\n\n## 図4 C社の解析結果 (概要)\n\n**i.ps1の動作**\n(a) タスクを登録する。登録するタスクの設定は次のとおりである。\n    タスク名: install\n    実行時に使うアカウント: タスク登録時に、ログオンしているアカウント\n    登録するスクリプトの動作: https://△△△.com/v/q.ps1をメモリ上に展開し、実行する。\n    タスク実行のトリガー: ログオン時に実行される。\n(b) タスクを登録した後に、(a)で登録したタスクを実行する。\n\n**q.ps1 の動作**\n(c) マルウェア対策ソフトを停止する。\n(d) 特定のディスク領域とネットワークドライブのファイルを RAR 形式でアーカイブファイルにまとめ、https://△△△.com/v/uplを使ってアップロードする。\n(e) 1時間おきに https://OOO.com/にコネクトバック通信をする。\n(f) (e)の通信ができない場合、リトライ通信を1回行う。リトライ通信に失敗した場合は、https://□□□.com/にコネクトバック通信をし、以降は、1時間おきに https://□□□.com/にコネクトバック通信をする。\n(g) パスワード又はパスワードハッシュをPCのメモリ上から窃取する。\n(h) ping コマンドを使ってホストを探索し、RDP接続を試みる。RDP接続に失敗した場合、何もしない。\n(i) RDP接続に成功すると、接続先でi.ps1の実行を試みる。\n\n```mermaid\nsequenceDiagram\n    participant PC_A\n    participant Attacker_C2_Upload[C2/△△△.com]\n    participant Attacker_C2_OOO[C2/OOO.com]\n    participant Attacker_C2_DDD[C2/□□□.com]\n    participant Internal_Hosts[L社内他ホスト]\n    \n    Note right of PC_A: (a) i.ps1実行 (ログオン時)\n    PC_A ->> Attacker_C2_Upload: (a) q.ps1ダウンロード\n    Note right of PC_A: (c) マルウェア対策ソフト停止\n    Note right of PC_A: (d) ファイルアーカイブ\n    PC_A ->> Attacker_C2_Upload: (d) ファイルアップロード (v/upl)\n    \n    loop 1時間ごと\n        PC_A ->> Attacker_C2_OOO: (e) コネクトバック通信\n    end\n    \n    alt 通信失敗\n        PC_A ->> Attacker_C2_OOO: (f) リトライ通信\n        alt リトライ失敗\n            loop 1時間ごと\n                PC_A ->> Attacker_C2_DDD: (f) コネクトバック通信\n            end\n        end\n    end\n    \n    Note right of PC_A: (g) 認証情報窃取\n    PC_A ->> Internal_Hosts: (h) ホスト探索/RDP接続試行\n    alt RDP接続成功\n        PC_A ->> Internal_Hosts: (i) i.ps1実行\n    end\n```\n\nYさんは図4の解析結果から、図3の追加調査の1及び2では、図4で解析したマルウェアが、今後、活動する可能性があるL社内ホストを見逃したおそれがあると考えた。Yさんは③追加調査の3として、L社内ホストの全てに対して新たな調査を行う必要があるのではないかとX主任に相談した。X主任は同意し、調査には時間が掛かるので、調査と並行して、④図4のマルウェアの活動を自動的に検出する新たな仕組みを作るように指示した。\n\nこの追加調査の3では、 [ a ] だけがマルウェアに感染した可能性があることが判明し、必要な対処を行った。また、新たにマルウェアの活動は検出されなかったので、復旧に向け対応を進めることにした。\n\n## [技術的対策の立案]\n\nX主任とYさんは、今回と同様のマルウェア感染が起きた場合に備えて、図3の暫定対策以外に、攻撃者による目的実行までの活動を阻止するための技術的対策を,表6のとおりにまとめた。\n\n## 表6 攻撃者による目的実行までの活動を阻止するための技術的対策\n\n| 今回の攻撃者による活動 | 技術的対策 |\n| :--- | :--- |\n| i.ps1 と q.ps1 をPC-Aで実行させた。 | PowerShell の実行ポリシーを設定し、署名のないスクリプトの実行を禁止する。 |\n| PC-Aからマルウェア感染を広げた。 | [ e ] |\n| q.ps1 がファイルを不正に持ち出した。 | [ f ] |\n\n今後,表6中の技術的対策について,X主任とYさんが中心となって導入の計画立案を進めることにした。",
  "questions": [
    {
      "subQNo": "設問1",
      "text": "〔暫定対策と追加調査の実施〕について答えよ。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "本文中及び図3中の [ a ] に入れる適切なホスト名を答えよ。",
          "explanation": "マルウェアはRDP接続によって感染を拡大させます（図4 (h), (i)）。表3のログを時系列で確認すると、PC-AはPC-BからPC-Gに対してRDP接続を試行しており、12/04 23:32:51にPC-CへのRDP接続がローカルアドミニストレーターアカウントで成功し、**許可**されています。RDP接続が成功した場合、攻撃者は接続先でi.ps1（マルウェア）を実行しようとするため、次に感染拡大した可能性が最も高いホストはPC-Cです。",
          "answer": "PC-C",
          "point": 10
        },
        {
          "label": "(2)",
          "text": "本文中の [ b ] に入れる適切なホスト名を答えよ。",
          "explanation": "マルウェア (q.ps1) はアーカイブ化されたファイルをインターネットにアップロードしています（図4(d)）。L社の社外秘情報Lはファイルサーバに保管するルールとなっており（表1）、そのファイルサーバのホスト名は `filesv` です。表3のログでも12/04 22:42:06に `\\\\filesv` へのファイル参照ログが確認できることから、ファイルが不正に持ち出された元である可能性が高いのはファイルサーバです。",
          "answer": "filesv",
          "point": 10
        },
        {
          "label": "(3)",
          "text": "本文中及び図3中の [ c ] に入れる適切なアカウント名を、表3の注記1に従って答えよ。",
          "explanation": "ファイルサーバの利用にはドメインサーバでの認証が必要です（表1）。PC-Aでマルウェアが実行された際、ログオンしていたアカウントの権限でファイルアクセスが行われました。表5（プロキシログ）によると、PC-Aからの通信は全て利用者ID `ad01\\user019` で行われているため、このアカウントがファイルアクセスに利用されたと考えられます。",
          "answer": "ad01\\user019",
          "point": 10
        },
        {
          "label": "(4)",
          "text": "図3中の [ d ] に入れる適切な対策を10字以内で答えよ。",
          "explanation": "暫定対策の目的はマルウェア感染拡大とファイルの送信を防ぐことです。マルウェアはドメインユーザー `ad01\\user019` の権限で活動し、RDP接続やファイルアップロードを行っています。このアカウントをドメインサーバで直ちに停止させることで、さらなる活動を阻止できます。10字以内の適切な対策として「無効化」が挙げられます。\n\n### 暫定対策のフロー\n```mermaid\nsequenceDiagram\n    participant X[X主任/Yさん]\n    participant DS[ドメインサーバ]\n    participant User019[ad01\\user019]\n    \n    X ->> DS: (d)アカウント無効化 (ad01\\user019)\n    Note right of User019: RDPログイン及びプロキシ認証が拒否される\n```",
          "answer": "無効化",
          "point": 10
        },
        {
          "label": "(5)",
          "text": "図3中の下線①について、対策の内容を、具体的に答えよ。",
          "explanation": "下線①はファイルの送信を防ぐプロキシサービスでの対策です。マルウェアは `https://△△△.com/v/upl` を用いて511MBのファイルをアップロードしました（表5）。この不正な持ち出しに利用されたURLをプロキシサービスの「管理者拒否リスト」に登録することで、今後のファイル送信を恒久的に阻止できます。",
          "answer": "不正なファイルの持ち出しに利用された宛先URL (https://△△△.com/v/upl) をプロキシサービスの管理者拒否リストに追加する。",
          "point": 10
        },
        {
          "label": "(6)",
          "text": "図3中の下線②について、調査の内容を、具体的に答えよ。",
          "explanation": "下線②はPC-A、[ a ]（PC-C）以外のホストにマルウェア感染が拡大していないか調査することです。マルウェアはコネクトバック通信先（OOO.comまたは□□□.com）へのアクセスを試みます（図4(e), (f)）。プロキシサービスの通信ログ（表5のようなデータ）を確認し、PC-AおよびPC-C以外のL社内ホストからこれらの悪性URLへのアクセスがないかを調査します。",
          "answer": "プロキシサービスの通信ログにおいて、PC-A及びPC-C以外のL社内ホストから、マルウェアのコネクトバック通信先である https://OOO.com/ または https://□□□.com/ へのアクセス試行がないかを確認する。",
          "point": 10
        },
        {
          "label": "(7)",
          "text": "本文中の下線③について、調査の内容を、具体的に答えよ。",
          "explanation": "下線③は、マルウェアの活動が判明した後に、L社内ホスト全てに対して行う追加調査です。全ホストの調査には、開発したFツール（図2）が適しています。全ホストのディスクイメージに対してFツールを実行し、time.csvなどの出力ファイルから、マルウェア活動の痕跡（タスク登録、セキュリティソフト停止、不正なファイル操作、RDP接続試行/成功など）がないかを徹底的に調査します。",
          "answer": "PC-A及びPC-C以外の全てのL社内ホストのディスクイメージを保守用PCにコピーしFツールを実行する。time.csvなどの出力ファイルを用いて、マルウェアの活動痕跡やRDPによる不正ログオン履歴がないか調査する。",
          "point": 10
        },
        {
          "label": "(8)",
          "text": "本文中の下線④について、検出する仕組みを、二つ答えよ。",
          "explanation": "マルウェア（q.ps1, i.ps1）の活動（図4）を自動的に検出する仕組みを二つ挙げます。一つは永続化のための仕組み、もう一つは外部との通信の仕組みを監視します。\n\n1. `i.ps1` は「install」というタスクをログオン時に実行されるよう登録します。このタスク登録を監視します。\n2. `q.ps1` は1時間おきに C2サーバ（OOO.comまたは□□□.com）へコネクトバック通信を試みます。プロキシサービスを利用してこの通信を監視します。\n\n検出の仕組み1:",
          "answer": "タスク名「install」の登録や実行を検知する仕組み。\n検出の仕組み2: プロキシサービスのログから、https://OOO.com/又はhttps://□□□.com/へのアクセスを検知する仕組み。",
          "point": 10
        }
      ],
      "subCategory": "その他"
    },
    {
      "subQNo": "設問2",
      "text": "表6中の [ e ], [ f ] に入れる適切な字句を答えよ。",
      "explanation": "表6は、攻撃者による目的実行までの活動を阻止するための技術的対策です。\n\n**[ e ] PC-Aからマルウェア感染を広げた。**\n感染拡大は、PC-Aから他の仮想PCへのRDP接続成功（図4(i)）によって達成されています。これを阻止するには、仮想PC間でのRDP接続自体を禁止するか、ローカルアドミニストレーター権限を剥奪するなどの対策が必要です。ネットワークレベルでの対策として、仮想PC間でのRDP接続を禁止することが有効です。\n\n**[ f ] q.ps1 がファイルを不正に持ち出した。**\n不正なファイルの持ち出しは、ファイルサーバ（filesv）にアクセスして機密情報をアーカイブ化し、外部にアップロードすることで実行されました。これを恒久的に防ぐには、ファイルサーバへのアクセス権限を最小限に制限することが重要です。\n\n```mermaid\ngraph TD\n    A[横展開(RDP)] --> E[e: 仮想PC間RDP接続禁止]\n    B[不正持ち出し(v/upl)] --> F[f: ファイルサーバアクセス制限]\n```",
      "subQuestions": [
        {
          "label": "e",
          "text": "",
          "answer": "仮想PC間RDP接続禁止",
          "point": 10
        },
        {
          "label": "f",
          "text": "",
          "answer": "ファイルサーバアクセス制限",
          "point": 10
        }
      ],
      "subCategory": "その他"
    }
  ]
}