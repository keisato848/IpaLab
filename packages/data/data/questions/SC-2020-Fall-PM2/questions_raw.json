{
  "qNo": 1,
  "theme": "百貨店における Web サイトの統合に関する情報セキュリティ",
  "description": "C社は，半年ほど前に旧A社と旧B社が合併してできた会社である。旧B社が存続会社となり，旧A社の事業を承継した上で，C社に改称した。C社は，旧A社の10店舗の百貨店（以下，A百貨店という）と，旧B社の5店舗の百貨店（以下，B百貨店という）を運営している。\n\nC社は，旧A社が発行していたクレジットカードの会員向けWebサイト（以下，サイトPという），A百貨店の取扱商品を販売するオンラインストアWebサイト（以下，サイトQという），及び旧B社のポイントカードを保有する会員向けWebサイト（以下，サイトRという）を運営している。合併後，顧客サービスの融合を図るため，これら3つのサイトのアカウント共通利用を実現することにした。\n\n### 表1 各サイトの概要\n\n| サイト名 | 機能 | 利用者ID |\n| :--- | :--- | :--- |\n| サイトP | 利用明細の表示，クレジットカード利用ポイントの残高確認，商品又は他社のポイントとの交換申請，各種申請書類の送付依頼，アカウント管理 | 英数字 8～16 字の文字列を利用者が設定する。 |\n| サイトQ | A百貨店の商品購入，購入履歴の表示，アカウント管理（新規登録，パスワード変更，決済用クレジットカード登録など） | 英数字 8～16 字の文字列を利用者が設定する。 |\n| サイトR | ポイント獲得履歴，利用履歴の表示，購買傾向の分析に基づいたお買い得情報の表示，キャンペーンへの応募，アカウント管理 | ポイントカードに記載されている数字 8 桁の会員番号が割り当てられる。 |\n\n### 〔機器の集約と運用作業の効率化〕\nC社では，各サイトを1か所のデータセンタに集約した。ネットワーク構成は図1のとおりである。\n\n```mermaid\ngraph TD\n    Internet((インターネット)) --- FW-1\n    FW-1 --- L2SW\n    \n    subgraph SiteP [サイトP]\n        FW-P --- Web-P[Web-P]\n        FW-P --- LDAP-P[LDAP-P]\n    end\n    \n    subgraph SiteQ [サイトQ]\n        FW-Q --- Web-Q[Web-Q]\n        FW-Q --- LDAP-Q[LDAP-Q]\n    end\n    \n    subgraph SiteR [サイトR]\n        FW-R --- Web-R[Web-R]\n        FW-R --- LDAP-R[LDAP-R]\n    end\n    \n    FW-1 --- FW-P\n    FW-1 --- FW-Q\n    FW-1 --- FW-R\n    \n    L2SW --- MonServer[監視サーバ]\n    L2SW --- AdminConsole[管理コンソール]\n    L2SW --- FW-2\n    FW-2 --- AdminLAN[Web管理課LAN]\n\n    style SiteP fill:#f9f,stroke:#333,stroke-width:2px\n    style SiteQ fill:#ccf,stroke:#333,stroke-width:2px\n    style SiteR fill:#cfc,stroke:#333,stroke-width:2px\n```\n注記 FW-1では，サイトP, Q, R相互間の通信を禁止している。\n\n### 〔サイト間でのアカウントの共通利用〕\nC社は，顧客がアカウントの紐付けを設定すれば，子アカウントの代わりに親アカウントを用いて各サイトにログインできるように設計した。紐付け情報はLDAPサーバに siteQid, siteRid などの属性として保存する。\n\n### 表2 変更後のFW-Pのルール（抜粋）\n\n| 項番 | 送信元 | 宛先 | プロトコル | 動作 |\n| :--- | :--- | :--- | :--- | :--- |\n| 1 | 監視サーバ，管理コンソール，Web管理課LAN | Web-P, LDAP-P | 管理用プロトコル | 許可 |\n| 2 | Web-Q, Web-R | LDAP-P | LDAP | 許可 |\n| 3 | Web-P | [ a ] | [ b ] | 許可 |\n| 15 | 全て | 全て | 全て | 拒否 |\n\n### 〔コードレビュー〕\nJ主任は，サイトPのWebアプリの改修に着手した。図3及び図4は，サイトPのアカウントにサイトQのアカウントを紐付ける場合のJavaソースコードである。K主任はコードレビューを行い，特定の状況下で他人のアカウントが紐付いてしまう脆弱性を指摘した。\n\n### 〔サイトRでのインシデント〕\nリリース直前に，サイトRでインシデントが発生した。攻撃者が会員番号及び誕生日を総当たりで入力し，他人のアカウントを乗っ取ったものと判断された。図5はパスワード失念時の画面である。\n\n### 〔アカウントの共通利用の設計の見直し〕\nJ主任は設計を全面的に見直し，SAMLプロトコルを用いたWeb Browser SSO Profileを採用することにした。新しく認証基盤となるサイトS（IdP）を立ち上げ，既存サイトはSPとなる。\n\n```mermaid\nsequenceDiagram\n    participant User as 利用者のWebブラウザ\n    participant SP as SP (サイトP, Q, R)\n    participant IdP as IdP (サイトS)\n    \n    User->>SP: ログインが必要なリソースへのアクセス要求\n    SP-->>User: IdPへの認証要求 (Redirect)\n    User->>IdP: (1) 転送された認証要求\n    Note over User,IdP: (2) 認証のための通信 (ID/PW確認)\n    IdP-->>User: IdPからSPへの認証応答 (SAML Response)\n    User->>SP: (3) 転送された認証応答\n    SP->>User: (4) 認証応答に基づいたリソース提供\n```",
  "questions": [
    {
      "subQNo": "設問1",
      "text": "表2中の [ a ], [ b ] に入れる適切な字句を答えよ。",
      "explanation": "アカウントの紐付け（共通利用）を実現するためには、親アカウント側のWebサーバが、子アカウント側のLDAPサーバに対して認証の問い合わせを行う必要があります。サイトPが親、QやRが子となる場合、Web-PからLDAP-QおよびLDAP-Rへの通信を許可する必要があります。\n\n### 通信の許可設定\n```mermaid\ngraph LR\n    WebP[Web-P] -- LDAPプロトコル --> LD_QR[LDAP-Q, LDAP-R]\n```",
      "subQuestions": [
        {
          "label": "a",
          "text": "LDAP-Q, LDAP-R",
          "point": 9
        },
        {
          "label": "b",
          "text": "LDAP",
          "point": 9
        }
      ]
    },
    {
      "subQNo": "設問2",
      "text": "〔個人情報の取扱い〕について，個人情報保護法に定められている禁止事項は何か。70字以内で述べよ。",
      "explanation": "個人情報保護法では、取得時に特定した利用目的の達成に必要な範囲を超えて、本人の同意を得ずに個人情報を取り扱うこと（目的外利用）が原則として禁止されています。今回の統合で利用目的が変わる場合は、改めて通知・同意が必要です。",
      "text_at_answer": "あらかじめ本人の同意を得ないで，特定された利用目的の達成に必要な範囲を超えて，個人情報を取り扱うこと。",
      "point": 9
    },
    {
      "subQNo": "設問3",
      "text": "〔コードレビュー〕について，(1)〜(3)に答えよ。",
      "explanation": "プログラムの脆弱性に関する問題です。図4のコードでは、セッションでログインしている本人ではなく、入力された任意のIDに対して紐付け処理を行ってしまう可能性や、リトライループの不備が指摘されています。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "本文中の [ c ], [ d ], [ f ], [ g ] に入れる適切な字句を，解答群の中から選び記号で答えよ。",
          "explanation": "コードのロジックから、cはリトライ回数に関する変数、dは例外、fは認証成功、gはチェックフラグに関連します。",
          "point": 9
        },
        {
          "label": "(2)",
          "text": "本文中の [ e ], [ h ] に入れる適切な図3又は図4中の行番号を，解答群の中から選び記号で答えよ。",
          "point": 8
        },
        {
          "label": "(3)",
          "text": "本文中の [ i ] に入れる適切な処理内容を 50 字以内で具体的に述べよ。",
          "explanation": "他人のアカウントを紐付けられないよう、認証を試みる前に、現在ログインしているユーザーと紐付け対象の整合性を確認するなどの修正が必要です。",
          "point": 8
        }
      ]
    },
    {
      "subQNo": "設問4",
      "text": "〔サイトRでのインシデント〕について，(1)〜(3)に答えよ。",
      "explanation": "パスワード失念時の機能が悪用されたケースです。本人確認要素が「会員番号」と「誕生日」だけであり、かつ総当たり攻撃（ブルートフォース）への対策が不十分であったことが原因です。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "本文中の [ j ] に入れる適切な内容を 40 字以内で述べよ。",
          "explanation": "「本人確認のための情報が推測容易である（または少なすぎる）」といった内容が入ります。",
          "point": 8
        },
        {
          "label": "(2)",
          "text": "本文中の [ k ] に入れる適切な内容を 40 字以内で述べよ。",
          "explanation": "総当たり攻撃を防ぐため、一定回数以上の試行失敗でロックする等の対策が必要です。",
          "point": 8
        },
        {
          "label": "(3)",
          "text": "下線①について，更に大きな被害とは何か。具体的な被害を二つ挙げ，それぞれ 30 字以内で述べよ。",
          "explanation": "アカウントが統合されていると、一つのサイトの乗っ取りが他サイト（クレジットカード情報があるサイトPなど）への不正ログインに直結します。",
          "point": 8
        }
      ]
    },
    {
      "subQNo": "設問5",
      "text": "〔アカウントの共通利用の設計の見直し〕について，(1)〜(3)に答えよ。",
      "explanation": "SAMLを用いたSSO（シングルサインオン）の挙動に関する理解を問う問題です。ブラウザを介したリダイレクトによって、認証情報がIdPからSPへ渡される仕組みを把握する必要があります。",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "図7の画面遷移において，(い)の画面は図6のどの時点の通信で表示されるか。(1)〜(4)の記号で答えよ。",
          "point": 8
        },
        {
          "label": "(2)",
          "text": "図7の画面遷移において，(あ)〜(う)の各画面は，どのサーバから送られたHTMLを表示するか。「SP」,「IdP」のいずれかを答えよ。",
          "point": 8
        },
        {
          "label": "(3)",
          "text": "図8の画面遷移において，各画面を表示するサーバは「SP」,「IdP」のいずれかを答えよ。",
          "point": 8
        }
      ]
    }
  ]
}