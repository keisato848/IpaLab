{
  "questions": [
    {
      "qNo": 1,
      "theme": "Webアプリケーションの脆弱性診断と対策（XSS）",
      "description": "Webアプリケーションの脆弱性（SSRF）を悪用した内部システムへの不正アクセスに関する事例と対応を問う。",
      "context": {
        "title": "サイトBのXSS脆弱性",
        "background": "\n\n元の問題のコンテキスト（背景情報）は提供されていません。\n\n【注記: 元の本文（設問1～3を含む）が欠落しているため、このコンテキストは設問4の解説から情報を再構成したものです。】\n\n（本文中の下線③は、攻撃者がサイトYのSSRF脆弱性を利用し、内部ネットワークにあるDBサーバのメンテナンス用Webインタフェースにアクセスを試みた状況を指す。）\n\nサイトYは、外部から指定されたURLに基づいて情報を取得する機能を提供している。\n\n{{diagram:fig4}}\n\n{{diagram:table2}}\n\n表2の注1によると、サイトYのDBサーバのメンテナンス用WebインタフェースのURLは `https://db-y.b-sha.co.jp/` である。",
        "diagrams": [
          {
            "id": "fig4",
            "label": "図4 攻撃者がサイトYに送信したリクエストの例",
            "type": "image",
            "content": "攻撃者がサイトYに送信したHTTP GETリクエストの例。リクエストには、情報を取得したい外部URLを指定するtopicパラメタが含まれている。SSRF攻撃に成功する前は、このパラメタにはA社のURLが指定されていたと推測される。"
          },
          {
            "id": "table2",
            "label": "表2 システム構成情報の一部",
            "type": "markdown",
            "content": "| 項目 | 値 | 備考 |\n|:---|:---|:---|\n| サイトY DBサーバ メンテナンス用WebインタフェースのURL | https://db-y.b-sha.co.jp/ | 注1"
          }
        ]
      },
      "questions": [
        {
          "subQNo": "設問1",
          "text": "〔サイトBのXSS 脆弱性〕について、(1), (2)に答えよ。",
          "references": [
            "fig1"
          ],
          "subQuestions": [
            {
              "label": "(1)",
              "text": "本文中の下線①における診断用リクエストの構成要素を、解答群の中から選び、記号で答えよ。\n解答群\nア リクエストライン:GET/confirm?\"\\u003e\\u003cimg src=1 onerror=alert(1)\\u003e\\u003c\"\nイ リクエストライン: GET/confirm?> <img src=1 onerror=alert(1)>\"\\u003c\"\nウ リクエストライン: POST/confirm\nリクエストボディ: \"\\u003e\\u003cimg src=1 onerror=alert(1)\\u003e\\u003c\"\nエ リクエストライン: POST/confirm\nリクエストボディ: >\\u003cimg src=1 onerror=alert(1)\\u003e\\u003c\"",
              "answer": "ア",
              "explanation": "サイトBのXSS脆弱性は、図1のコードにおいて、クエリ文字列(`queryString`)がHTMLタグの属性値内にエスケープされずに直接出力されていることに起因します。\n\nhtml\n<meta property=\"og:url\" content=\"https://...?[queryStringの値]\">\n\n\n攻撃を成功させるには、まず `content` 属性を閉じ、次に `meta` タグ自体を閉じる必要があります。一般的なXSSペイロードである `\"><img src=1 onerror=alert(1)><` を `queryString` として注入します。\n\n1.  **\"** (ダブルクォート): `content` 属性を閉じる。\n2.  **>** (不等号): `meta` タグを閉じる。\n3.  **<img src=1 onerror=alert(1)>**: 任意のHTML要素（ここではXSSペイロード）を挿入。\n4.  **<**: ペイロード終了。\n\n解答群アの `GET/confirm?\"\\u003e\\u003cimg src=1 onerror=alert(1)\\u003e\\u003c\"` は、クエリ文字列として `\"\\u003e\\u003cimg src=1 onerror=alert(1)\\u003e\\u003c\"` が送信されることを想定しています。これは、URLデコード後に `\"><img src=1 onerror=alert(1)\\u003e\\u003c\"` となり、XSSを成立させるための典型的なペイロードです。（末尾の`\"`は元のコードの`\">`と結合して`\"\">`になるが、XSSは既に成功している）。"
            },
            {
              "label": "(2)",
              "text": "本文中の下線②について、考えられる再発防止策を,35字以内で述べよ。",
              "answer": "安全性が確認されたライブラリをリスト化し、それ以外は使用しないよう制限する。",
              "explanation": "XSS脆弱性の原因として、既知の脆弱性対策をしていないライブラリMを利用していたことが指摘されています。開発者が個別にライブラリを収集・利用できる環境にあるため、安全なライブラリのみを使用する仕組みが必要です。\n\nまた、根本的な対策としては「ユーザーからの入力をHTMLに出力する際、適切なエスケープ処理を実施する」も考えられますが、文脈（ライブラリ管理の不備）を考慮すると、ライブラリの使用に関するプロセス改善がより適切な再発防止策となります。"
            }
          ],
          "point": 16
        },
        {
          "subQNo": "設問2",
          "text": "本文中の [ a ], [ b ] に入れる適切な字句を答えよ。",
          "references": [],
          "explanation": "### 設問2 解説\n\nサイトXのCSRF脆弱性の確認手順(2)では、利用者Bがログインしたセッションで、利用者AのCSRFトークンを使用してリクエストを送信したところ、処理が成功しました。これは、サーバがそのトークンが現在のセッションや、そのセッションを保持する利用者に紐づいているかを検証していないことを意味します。\n\nCSRFトークンは、そのトークンを発行した**セッションID**や、そのセッションに対応する**利用者ID**（または**利用者の識別情報**）と紐づけて検証する必要があります。",
          "subQuestions": [
            {
              "label": "a",
              "text": "[ a ] に入れる適切な字句",
              "answer": "セッションID"
            },
            {
              "label": "b",
              "text": "[ b ] に入れる適切な字句",
              "answer": "利用者ID"
            }
          ],
          "point": 16
        },
        {
          "subQNo": "設問3",
          "text": "〔サイトXのクリックジャッキング脆弱性〕について、(1), (2)に答えよ。",
          "references": [],
          "subQuestions": [
            {
              "label": "(1)",
              "text": "本文中の [ c ] 〜 [ h ] に入れる適切な字句を、それぞれの解答群の中から選び、記号で答えよ。\nc, fに関する解答群: ア α, イ β\nd, gに関する解答群: ア 奥, イ 手前\ne, hに関する解答群: ア 可視の, イ 透明な",
              "answer": "c: イ, d: イ, e: ア, f: ア, g: ア, h: イ",
              "explanation": "クリックジャッキング攻撃では、ユーザーを騙すための罠サイト（画面β）を一番手前（可視）に配置し、クリックさせたいターゲットサイト（画面α）を奥に配置したIFrame内に埋め込み、そのIFrameを透明に設定します。\n\n*   [ c ]: 攻撃者が用意した罠画面は**画面β**です。(イ)\n*   [ d ]: 罠サイト(β)は、利用者から見て一番**手前**に表示されます。(イ)\n*   [ e ]: 罠サイト(β)の見た目（クリックを誘うボタンなど）は通常**可視の**状態です。(ア)\n*   [ f ]: ターゲットとなるサイトXの画面は**画面α**です。(ア)\n*   [ g ]: ターゲット画面(α)は、罠画面(β)よりも**奥**に配置されます。(ア)\n*   [ h ]: ユーザーのクリックイベントを透過させるため、奥にある画面αを埋め込んだIFrame/要素は**透明な**状態で重ねられます。(イ)\n"
            },
            {
              "label": "(2)",
              "text": "本文中の [ i ], [ j ] に入れる適切な字句を、解答群の中から選び、記号で答えよ。\n解答群\nア Content-Disposition\nイ Content-Security-Policy\nウ X-Content-Type-Options\nエ X-Frame-Options",
              "answer": "i: イ, j: エ",
              "explanation": "[ j ] は「後者は標準化されている」とあるため、長らくデファクトスタンダードとして使用されてきた **X-Frame-Options** (エ) が適切です。\n\n[ i ] には、より柔軟な制御が可能で、現在推奨されている **Content-Security-Policy** (イ) の `frame-ancestors` ディレクティブを利用する方法が入ります。\n"
            }
          ],
          "point": 16
        },
        {
          "subQNo": "設問4",
          "text": "本文中の下線③について、図4のリクエスト中のどの値をどのような値に変更したか。45字以内で具体的に述べよ。",
          "references": [
            "fig4",
            "table2"
          ],
          "answer": "topicパラメタの値を、A社のURLからサイトYのDBサーバのメンテナンス用WebインタフェースのURL(https://db-y.b-sha.co.jp/)に変更した。",
          "explanation": "下線③は、サイトYのSSRF脆弱性を利用して、サイトYのDBサーバのメンテナンス用Webインタフェースにアクセスした状況を指します。サイトYは、図4のリクエストの `topic` パラメタに指定されたURLから情報を取得します。これがSSRFの発生源です。サイトYのDBサーバのメンテナンス用WebインタフェースのURLは、表2の注記1より `https://db-y.b-sha.co.jp/` です。",
          "point": 16
        },
        {
          "subQNo": "設問6",
          "text": "[開発プロセスの見直し〕について、(1)~(4)に答えよ。",
          "references": [
            "table1",
            "table3",
            "fig7"
          ],
          "subQuestions": [
            {
              "label": "(1)",
              "text": "本文中の下線⑤について、該当する脆弱性を二つ挙げ、それぞれ15字以内で答えよ。",
              "answer": "CSRF脆弱性; SSRF脆弱性",
              "explanation": "下線⑤は、静的解析や簡易なツール診断では検出が難しく、専門家による動的な診断やロジック分析が必要な脆弱性を指します。\n\n表1において、項番5（専門技術者による診断）はセッション管理と認可・アクセス制御を対象としていますが、項番2, 3, 4はそれらが対象外または一部のみです。CSRFやSSRFは、動的なリクエスト操作や外部連携機能の検証が必要であり、専門家による診断で効果的に検出されます。（表3でも、XSSは他の手段でも検出された可能性があるが、CSRF, クリックジャッキング, SSRFは専門診断の結果として挙げられている）"
            },
            {
              "label": "(2)",
              "text": "本文中の下線⑥について、専門技術者による脆弱性診断が長期間行われないことを避けるためには、どのような時期に実施すればよいか。改良リリースの実施に影響を与えないことを前提に、20字以内で答えよ。",
              "answer": "改良フェーズで半年に一度設ける1か月の休止期間。",
              "explanation": "専門技術者による脆弱性診断は期間を要します（10日間）。アジャイル開発の2週間リリースサイクル中に組み込むのは困難であり、リリースの実施に影響を与えてしまいます。\n図7の注記2にある通り、改良フェーズでは半年に一度、1か月の休止期間が設けられています。この期間は、長期休暇や研修、Webサイトの点検などに使われており、脆弱性診断を実施するのに最適です。"
            },
            {
              "label": "(3)",
              "text": "本文中の下線⑦について、専門技術者による脆弱性診断が長期間行われないことを避けるためには、開発プロセスをどのように見直せばよいか。アジャイル開発の継続を前提に、40字以内で述べよ。",
              "answer": "改良リリースの休止期間とは別に、専門技術者による脆弱性診断を定期的に計画し、実施するプロセスを導入する。",
              "explanation": "アジャイル開発を継続しつつ、長期間診断を避けるためには、開発サイクル（設計、実装、テスト）とは独立した計画が必要です。診断を休止期間に依存させるだけでなく、例えば年次計画などに組み込み、定期的に実施する管理プロセスを明確に導入することが、開発プロセスにおける見直しとなります。"
            },
            {
              "label": "(4)",
              "text": "本文中の下線⑧について,CSRF 脆弱性の場合では,どのような処理を行う機能が考えられるか。その処理を,55字以内で具体的に述べよ。",
              "answer": "リクエストごとにセッションに紐づいた推測困難なCSRFトークンを自動で生成し、POSTリクエスト時にそのトークンが一致するか検証する処理。",
              "explanation": "CSRF対策としてフレームワークが提供する機能は、セッションと結びついたトークン（ワンタイムトークン）の自動生成と検証です。これにより、外部からの不正なリクエストを排除できます。設問2で指摘された「セッションIDとトークンをひも付ける」処理を自動で行う機能が該当する。"
            }
          ],
          "point": 16
        }
      ],
      "point": 16
    },
    {
      "qNo": 2,
      "theme": "サプライチェーンにおけるWebアプリケーションのセキュリティ対策",
      "description": "サイトZにおけるSSRF脆弱性とその対策に関する問題。提供されたデータは設問5のみ。",
      "context": {
        "title": "サイトZにおけるSSRF脆弱性とその対策",
        "background": "L社は、グループ会社B社のシステムインテグレータ部門が構築・運用する複数のWebサイト（サイトY及びサイトZ）を所有している。サイトZは、外部のサービス（P社宿泊サイト）と連携する機能を持つが、この連携機能にSSRF脆弱性が存在することが判明した。\n\n## サイトZのSSRF脆弱性\n\nこの脆弱性を悪用したV氏による攻撃の手順は{{diagram:table4}}のとおりであった。\n\nB社は、このSSRF脆弱性対策として、URLのアクセス先をチェックする方式を採用することを検討した。しかし、これは完全な対策ではないため、下線④別の対策も実施する必要がある。\n\n注1: サイトZのWebサーバは、DBサーバのメンテナンスインタフェース（内部リソース）にアクセス可能なネットワーク構成となっていた。",
        "diagrams": [
          {
            "id": "table4",
            "label": "表4 V氏によるSSRF攻撃の手順",
            "type": "markdown",
            "content": "| 手順 | 説明 |\n| :--- | :--- |\n| 1 | V氏は、サイトZに対して、あるパラメータの値を、P社宿泊サイトのURLを含むように細工したリクエストR1を送信する。ただし、R1のHostヘッダはV氏のサイトのFQDNに変更されている。|\n| 2 | サイトZは、リクエストR1を処理し、P社宿泊サイトへリクエストR2（認証情報Authorizationヘッダを含む）を送信する。|\n| 3 | P社宿泊サイトは、リクエストR2に対するレスポンスとして、301（Moved Permanently）を返す。このレスポンスには、リダイレクト先として、[ k ] を含めたURLが含まれる。|\n| 4 | サイトZは、受け取ったレスポンスを基に、[ k ] にリクエストR3を送る。|\n| 5 | リクエストR3はV氏のサイトに到達する。V氏は、リクエストR3に含まれるAuthorizationヘッダの値を取得する。|"
          }
        ]
      },
      "questions": [
        {
          "subQNo": "設問5",
          "text": "〔サイトZのSSRF 脆弱性〕について、(1), (2)に答えよ。",
          "references": [
            "table4"
          ],
          "subQuestions": [
            {
              "label": "(1)",
              "text": "表4中の [ k ] に入れる適切な字句を,15字以内で答えよ。",
              "answer": "Locationヘッダの値",
              "explanation": "表4の手順3において、P社宿泊サイトはサイトZからのリクエストに対する301レスポンスの一部として、Locationヘッダに [ k ] を含めたURLを返します。手順4で、サイトZは「受け取ったレスポンスを基に、 [ k ] にリクエストを送る」とあるため、[ k ] はP社が返したLocationヘッダの値、つまりリダイレクト先URLそのものを指します。\nV氏が手順1でHostヘッダを自身のFQDNに変更したため、サイトZはP社からのリダイレクトとして、V氏のサイトのURLを受け取り、そのURL（k）にアクセスすることで、P社向けに利用されるはずだったAuthorizationヘッダの値を受け取ることができたと考えられます。"
            },
            {
              "label": "(2)",
              "text": "本文中の下線④について、別の対策とは何か。B社で実施することが望ましい対策を,25字以内で述べよ。",
              "answer": "Webサーバから内部ネットワークへの通信を遮断する。",
              "explanation": "既に提案された対策（URLのアクセス先チェック）に加え、別の対策として望ましいのは、SSRF攻撃が成功しても内部リソースに被害が及ばないように、ネットワークレベルで防御を講じることです。\n\nサイトYおよびZのWebサーバは、SSRF実行によってDBサーバのメンテナンスインタフェース（内部リソース）にアクセスできてしまいました。Webサーバが、本来アクセスが不要な内部ネットワークセグメント（DBサーバ）に対して通信できないよう、ファイアウォールなどでアウトバウンド通信を制限（最小権限の原則）することが最も効果的です。"
            }
          ],
          "point": 16
        }
      ],
      "point": 16
    }
  ]
}