# データベース設計検討: サブカテゴリ導入と分析機能の強化

「ダッシュボードでの詳細分析」および「サブカテゴリ (SubCategory) の導入」について、メリット・デメリットおよび実装方針を検討しました。

## 1. 検討背景
- **要望:**
  - ダッシュボードに「年度別正解率」「分野別正解率」「成長推移」を表示したい。
  - `Category` (テクノロジ等) だけでは粗すぎるため、`SubCategory` を導入して分析精度を上げたい。
- **論点:**
  - 将来的な保守性・拡張性を考慮した設計はどうあるべきか。

## 2. SubCategory 導入のメリット・デメリット

| 項目                     | メリット (Pros)                                                                                                                  | デメリット (Cons)                                                                                        |
| :----------------------- | :------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------- |
| **学習効果 (Analytics)** | 「ネットワークが苦手」「セキュリティは得意」といった**具体的・実用的な弱点分析**が可能になる。ユーザーの学習意欲向上に直結する。 | データ投入時の負荷増。問題ごとに適切なサブカテゴリを判定・入力する必要がある。                           |
| **拡張性 (Scalability)** | 将来的に「AI・ビッグデータ」等の新分野が登場しても、`SubCategory` の値を追加するだけで対応可能（スキーマ変更不要）。             | カテゴリ体系（Taxonomy）の管理コスト。表記揺れ（"Security" vs "Sec"）を防ぐ仕組み（Enum/Master）が必要。 |
| **出題などへの応用**     | 「苦手な『データベース』分野だけ集中特訓」といった機能が実装しやすくなる。                                                       | クエリが複雑化する可能性がある（インデックス調整など）。                                                 |

### 結論
**導入すべきです。**
IPAの試験区分（中分類・小分類）は明確に定義されており、これを `SubCategory` として保持することは、分析機能の価値を最大化するために不可欠です。
NoSQL (Cosmos DB) の柔軟性を活かし、固定スキーマではなく「タグ」に近い運用にすることで、将来の区分改定にも柔軟に対応します。

## 3. 実装方針

### 3.1 `Questions` コンテナの変更
`subCategory` フィールドを追加します。

```json
{
  "category": "Technology", // 大分類 (テクノロジ系)
  "subCategory": "Security", // 中分類/小分類 (セキュリティ)
  ...
}
```

### 3.2 分析データの集計方式
リアルタイム集計はデータ量が増えるとコスト高になるため、ダッシュボード表示には工夫が必要です。

- **案1: オンデマンド集計 (MVP推奨)**
  - `LearningRecords` の件数が少ないうちは、API呼び出し時に Functions で集計する。
- **案2: 集計済みデータの保持 (Future)**
  - `UserStats` コンテナを作成し、「分野別正解数」などを非同期で更新する。

今回は **案1 (オンデマンド)** でスタートし、パフォーマンス監視を行いつつ案2へ移行可能な設計とします。

## 4. ダッシュボードUIへの反映
`docs/02_design/04_ScreenTransition.md` を更新し、以下のウィジェットを追加します。
- **Radar Chart:** 分野(SubCategory)別正解率
- **Line Chart:** 学習日ごとの正解率推移
- **Table:** 年度別正解率リスト
